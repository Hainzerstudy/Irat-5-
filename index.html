<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación Clínica IRAT-5 </title>
    <!-- Bibliotecas para PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1e3c72;
            --secondary-color: #2a5298;
            --accent-color: #4CAF50;
            --warning-color: #FF9800;
            --danger-color: #F44336;
            --light-color: #f8f9fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7ff;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .section {
            padding: 25px;
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            color: var(--primary-color);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary-color);
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        select.form-control {
            background-color: white;
            cursor: pointer;
        }
        
        .question-group {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .score-display {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin: 25px 0;
        }
        
        .score-value {
            font-size: 3.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .risk-level {
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            color: white;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .risk-low { background: linear-gradient(135deg, #4CAF50, #2E7D32); }
        .risk-moderate { background: linear-gradient(135deg, #FF9800, #EF6C00); }
        .risk-high { background: linear-gradient(135deg, #F44336, #C62828); }
        .risk-very-high { background: linear-gradient(135deg, #9C27B0, #6A1B9A); }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #EF6C00);
            color: white;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .nav-tabs {
            display: flex;
            background: #f0f2f5;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 15px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .nav-tab:hover {
            background: rgba(255,255,255,0.5);
        }
        
        .nav-tab.active {
            border-bottom-color: var(--primary-color);
            background: white;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .recommendations-grid {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }
        
        .recommendation-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
        }
        
        /* Sección Compartir */
        .share-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .share-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .share-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .share-icon {
            font-size: 2.8rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .share-card h3 {
            margin: 10px 0;
            color: var(--primary-color);
        }
        
        .share-card p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Notificaciones */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s ease;
            max-width: 350px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #F44336, #C62828);
        }
        
        .notification.info {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }
        
        .notification.warning {
            background: linear-gradient(135deg, #FF9800, #EF6C00);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Grid para formularios */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        /* Sección Tinetti completa */
        .tinetti-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .tinetti-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .tinetti-section h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.1rem;
            background: rgba(30, 60, 114, 0.1);
            padding: 10px;
            border-radius: 5px;
        }
        
        .tinetti-option {
            margin-bottom: 10px;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tinetti-option:hover {
            border-color: var(--primary-color);
            background: #f0f7ff;
        }
        
        .tinetti-option.selected {
            border-color: var(--accent-color);
            background: #e8f5e9;
            font-weight: 600;
        }
        
        .tinetti-score-box {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        /* Estilos para resultados */
        .resultados-detallados {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .resultado-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .resultado-item:last-child {
            border-bottom: none;
        }
        
        .resultado-label {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .resultado-valor {
            font-weight: 500;
        }
        
        /* Informe profesional */
        .informe-profesional {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .cabecera-informe {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .logo-informe {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .titulo-informe {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .subtitulo-informe {
            color: #666;
            font-size: 1rem;
        }
        
        .seccion-informe {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .seccion-informe h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tabla-informe {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .tabla-informe th {
            background: var(--primary-color);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        .tabla-informe td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tabla-informe tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .firma-informe {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }
        
        .firma-linea {
            width: 300px;
            height: 1px;
            background: #333;
            margin: 40px 0 10px 0;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .section {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .score-value {
                font-size: 2.8rem;
            }
            
            .btn {
                width: 100%;
                margin: 5px 0;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .share-options {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .informe-profesional {
                padding: 20px;
            }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .info-box {
            background: #e8f4fd;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid var(--warning-color);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .error-input {
            border-color: var(--danger-color) !important;
            background-color: #fff5f5;
        }
        
        /* Estilos para el informe en pantalla */
        .informe-pantalla {
            background: white;
            padding: 30px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            margin: 20px 0;
            font-family: 'Times New Roman', Times, serif;
        }
        
        .encabezado-informe {
            text-align: center;
            border-bottom: 3px double #333;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .datos-paciente-informe {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        
        .resultados-finales {
            margin: 30px 0;
            padding: 20px;
            background: #f0f7ff;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-hospital-alt"></i> IRAT-5 + Tinetti + Norton</h1>
            <p>Evaluación Clínica Integral de Riesgo - Sistema Profesional</p>
        </div>
        
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-section="identificacion">Identificación</button>
            <button class="nav-tab" data-section="evaluacion">IRAT-5</button>
            <button class="nav-tab" data-section="tinetti">Tinetti</button>
            <button class="nav-tab" data-section="norton">Norton</button>
            <button class="nav-tab" data-section="resultados">Resultados</button>
            <button class="nav-tab" data-section="compartir">Compartir</button>
        </div>
        
        <!-- Sección 1: Identificación -->
        <section id="identificacion" class="section active">
            <h2 class="section-title"><i class="fas fa-user"></i> Identificación del Paciente</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Nombre completo <span style="color:red">*</span></label>
                    <input type="text" id="nombre" class="form-control" placeholder="Nombre y apellidos del paciente" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">RUT / Identificación</label>
                    <input type="text" id="rut" class="form-control" placeholder="Ej: 12.345.678-9">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Edad</label>
                    <input type="number" id="edad" class="form-control" placeholder="Edad en años">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Fecha evaluación <span style="color:red">*</span></label>
                    <input type="date" id="fecha" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Sexo</label>
                    <select id="sexo" class="form-control">
                        <option value="">Seleccione...</option>
                        <option value="masculino">Masculino</option>
                        <option value="femenino">Femenino</option>
                        <option value="no especificado">No especificado</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Evaluador <span style="color:red">*</span></label>
                    <input type="text" id="evaluador" class="form-control" placeholder="Nombre del profesional" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Institución/Clínica</label>
                    <input type="text" id="institucion" class="form-control" placeholder="Nombre de la institución">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Número de Historia Clínica</label>
                    <input type="text" id="historia-clinica" class="form-control" placeholder="Número de identificación">
                </div>
            </div>
            
            <div class="action-buttons">
                <div></div>
                <button class="btn btn-primary" id="siguiente-irat">
                    <i class="fas fa-arrow-right"></i> Siguiente: IRAT-5
                </button>
            </div>
        </section>
        
        <!-- Sección 2: IRAT-5 -->
        <section id="evaluacion" class="section">
            <h2 class="section-title"><i class="fas fa-clipboard-list"></i> Evaluación IRAT-5 Modificado</h2>
            
            <div class="question-group">
                <div class="question-text">1. Equilibrio Unipodal <span style="color:red">*</span></div>
                <select id="equilibrio" class="form-control" required>
                    <option value="">Seleccione...</option>
                    <option value="0">≥ 30 segundos (0 pts)</option>
                    <option value="1">15-29 segundos (1 pts)</option>
                    <option value="2">5-14 segundos (2 pts)</option>
                    <option value="3">< 5 segundos (3 pts)</option>
                    <option value="4">No puede mantenerse (4 pts)</option>
                </select>
            </div>
            
            <div class="question-group">
                <div class="question-text">2. Tipo de Amputación <span style="color:red">*</span></div>
                <select id="amputacion" class="form-control" required>
                    <option value="">Seleccione...</option>
                    <option value="0">Sin amputaciones (0 pts)</option>
                    <option value="1">Amputación transmetatarsiana (1 pts)</option>
                    <option value="3">Unilateral infracondílea (3 pts + 1 riesgo caídas)</option>
                    <option value="4">Bilateral infracondílea (4 pts + 1 riesgo caídas)</option>
                    <option value="5">Supracondílea unilateral (5 pts + 1 riesgo caídas)</option>
                    <option value="6">Supracondílea bilateral (6 pts + 1 riesgo caídas)</option>
                </select>
            </div>
            
            <div class="warning-box">
                <strong><i class="fas fa-exclamation-triangle"></i> Consideraciones amputaciones:</strong><br>
                • Bilaterales: Requieren silla de ruedas (NO bastón/andador)<br>
                • Unilaterales: Iniciar con andador articulado/fijo (sin ruedas)
            </div>
            
            <div class="question-group">
                <div class="question-text">3. Función de Brazos <span style="color:red">*</span></div>
                <select id="brazos" class="form-control" required>
                    <option value="">Seleccione...</option>
                    <option value="0">Ambos brazos normales o fuerza ≥3 (0 pts)</option>
                    <option value="1">Problemas en un brazo/fuerza <3 (1 pts)</option>
                    <option value="2">Problemas en ambos brazos (2 pts)</option>
                </select>
            </div>
            
            <div class="question-group">
                <div class="question-text">4. Situación Social <span style="color:red">*</span></div>
                <select id="social" class="form-control" required>
                    <option value="">Seleccione...</option>
                    <option value="0">Cuidador profesional (0 pts)</option>
                    <option value="1">Cuidador informal (1 pts)</option>
                    <option value="2">Vive solo o sin cuidador (2 pts)</option>
                    <option value="3">Es cuidador de persona frágil (3 pts)</option>
                </select>
            </div>
            
            <div class="question-group">
                <div class="question-text">5. Nivel de Cooperación <span style="color:red">*</span></div>
                <select id="cooperacion" class="form-control" required>
                    <option value="">Seleccione...</option>
                    <option value="0">Excelente - Sigue todas las instrucciones (0 pts)</option>
                    <option value="1">Buena - Sigue mayoría de instrucciones (1 pts)</option>
                    <option value="2">Moderada - Requiere motivación constante (2 pts)</option>
                    <option value="3">Mala - Se resiste o rechaza instrucciones (3 pts)</option>
                </select>
            </div>
            
            <div class="score-display">
                <div>Puntaje IRAT-5 (preliminar)</div>
                <div class="score-value" id="puntaje-irat">0</div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-warning" id="volver-identificacion">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button class="btn btn-primary" id="siguiente-tinetti">
                    Siguiente: Tinetti <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </section>
        
        <!-- Sección 3: Tinetti COMPLETO -->
        <section id="tinetti" class="section">
            <h2 class="section-title"><i class="fas fa-walking"></i> Test de Tinetti Completo</h2>
            
            <div class="info-box">
                <strong>Conversión a puntos IRAT-5:</strong><br>
                • Tinetti ≥ 25 puntos = 0 puntos IRAT-5<br>
                • Tinetti 19-24 puntos = 2 puntos IRAT-5<br>
                • Tinetti ≤ 18 puntos = 4 puntos IRAT-5<br>
                • No evaluable = 4 puntos IRAT-5 (máximo riesgo)
            </div>
            
            <div class="tinetti-container">
                <!-- Opción No Evaluable -->
                <div class="question-group">
                    <div class="question-text">¿Es evaluable el Test de Tinetti? <span style="color:red">*</span></div>
                    <div id="opcion-no-evaluable" class="tinetti-option" data-puntaje="0" data-irat="4">
                        <strong>NO EVALUABLE</strong><br>
                        <small>Paciente no puede realizar la prueba (máximo riesgo - 4 puntos IRAT-5)</small>
                    </div>
                </div>
                
                <!-- Si es evaluable, mostrar el test completo -->
                <div id="test-tinetti-completo">
                    <div class="tinetti-section">
                        <h4>EQUILIBRIO (Máximo 16 puntos)</h4>
                        
                        <!-- Pregunta 1 -->
                        <div class="question-group">
                            <div class="question-text">1. Sentado sin apoyo</div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="balance1">
                                <strong>1 punto - Estable, seguro</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="balance1">
                                <strong>0 puntos - Se cae o se desliza</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 2 -->
                        <div class="question-group">
                            <div class="question-text">2. Levantarse</div>
                            <div class="tinetti-option" data-puntaje="2" data-grupo="balance2">
                                <strong>2 puntos - Capaz sin usar brazos</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="balance2">
                                <strong>1 punto - Capaz, usa brazos para ayudarse</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="balance2">
                                <strong>0 puntos - Incapaz sin ayuda</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 3 -->
                        <div class="question-group">
                            <div class="question-text">3. Intentos de levantarse</div>
                            <div class="tinetti-option" data-puntaje="2" data-grupo="balance3">
                                <strong>2 puntos - Capaz, se levanta con un intento</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="balance3">
                                <strong>1 punto - Capaz, requiere más de un intento</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="balance3">
                                <strong>0 puntos - Incapaz sin ayuda</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 4 -->
                        <div class="question-group">
                            <div class="question-text">4. Equilibrio inmediato al levantarse (primeros 5 segundos)</div>
                            <div class="tinetti-option" data-puntaje="2" data-grupo="balance4">
                                <strong>2 puntos - Estable sin apoyo</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="balance4">
                                <strong>1 punto - Estable pero usa bastón o andador</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="balance4">
                                <strong>0 puntos - Inestable (se tambalea, mueve pies)</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 5 -->
                        <div class="question-group">
                            <div class="question-text">5. Equilibrio de pie</div>
                            <div class="tinetti-option" data-puntaje="2" data-grupo="balance5">
                                <strong>2 puntos - Estable sin apoyo estrecho</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="balance5">
                                <strong>1 punto - Estable con apoyo amplio o usa bastón/andador</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="balance5">
                                <strong>0 puntos - Inestable</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 6 -->
                        <div class="question-group">
                            <div class="question-text">6. Equilibrio con ojos cerrados</div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="balance6">
                                <strong>1 punto - Estable</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="balance6">
                                <strong>0 puntos - Inestable</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 7 -->
                        <div class="question-group">
                            <div class="question-text">7. Girar 360 grados</div>
                            <div class="tinetti-option" data-puntaje="2" data-grupo="balance7">
                                <strong>2 puntos - Continuo y estable</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="balance7">
                                <strong>1 punto - Pasos continuos</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="balance7">
                                <strong>0 puntos - Pasos discontinuos</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 8 -->
                        <div class="question-group">
                            <div class="question-text">8. Sentarse</div>
                            <div class="tinetti-option" data-puntaje="2" data-grupo="balance8">
                                <strong>2 puntos - Seguro, movimientos suaves</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="balance8">
                                <strong>1 punto - Usa brazos o no es suave</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="balance8">
                                <strong>0 puntos - Inseguro (mal alineamiento, distancia)</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tinetti-section">
                        <h4>MARCHA (Máximo 12 puntos)</h4>
                        
                        <!-- Pregunta 9 -->
                        <div class="question-group">
                            <div class="question-text">9. Inicio de la marcha (inmediatamente después de ordenar "camine")</div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="gait9">
                                <strong>1 punto - Sin vacilación</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="gait9">
                                <strong>0 puntos - Cualquier vacilación o múltiples intentos</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 10 -->
                        <div class="question-group">
                            <div class="question-text">10. Longitud y altura del paso (pie derecho)</div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="gait10">
                                <strong>1 punto - Pasa al derecho</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="gait10">
                                <strong>0 puntos - Pie izquierdo no pasa al derecho</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 11 -->
                        <div class="question-group">
                            <div class="question-text">11. Longitud y altura del paso (pie izquierdo)</div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="gait11">
                                <strong>1 punto - Pasa al izquierdo</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="gait11">
                                <strong>0 puntos - Pie derecho no pasa al izquierdo</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 12 -->
                        <div class="question-group">
                            <div class="question-text">12. Simetría del paso</div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="gait12">
                                <strong>1 punto - Simétrico</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="gait12">
                                <strong>0 puntos - Asimétrico</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 13 -->
                        <div class="question-group">
                            <div class="question-text">13. Continuidad del paso</div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="gait13">
                                <strong>1 punto - Continuo</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="gait13">
                                <strong>0 puntos - Interrumpido o discontinuo</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 14 -->
                        <div class="question-group">
                            <div class="question-text">14. Desviación de la marcha</div>
                            <div class="tinetti-option" data-puntaje="2" data-grupo="gait14">
                                <strong>2 puntos - Sin desviación</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="gait14">
                                <strong>1 punto - Se desvía levemente/usa dispositivo</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="gait14">
                                <strong>0 puntos - Se desvía marcadamente</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 15 -->
                        <div class="question-group">
                            <div class="question-text">15. Tronco</div>
                            <div class="tinetti-option" data-puntaje="2" data-grupo="gait15">
                                <strong>2 puntos - Sin oscilación, sin flexión</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="gait15">
                                <strong>1 punto - Sin oscilación pero flexión rodillas/espalda</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="gait15">
                                <strong>0 puntos - Marcada oscilación o usa dispositivo</strong>
                            </div>
                        </div>
                        
                        <!-- Pregunta 16 -->
                        <div class="question-group">
                            <div class="question-text">16. Base de sustentación</div>
                            <div class="tinetti-option" data-puntaje="1" data-grupo="gait16">
                                <strong>1 punto - Talones casi juntos al caminar</strong>
                            </div>
                            <div class="tinetti-option" data-puntaje="0" data-grupo="gait16">
                                <strong>0 puntos - Talones separados al caminar</strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Resultados Tinetti -->
                <div id="resultado-tinetti" style="display: none;">
                    <div class="tinetti-score-box">
                        <h4>Resultado Test de Tinetti</h4>
                        <div class="score-value" id="puntaje-tinetti-total">0</div>
                        <div>/28 puntos</div>
                        <div id="interpretacion-tinetti"></div>
                        <div id="puntos-irat-tinetti"></div>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-warning" id="volver-irat">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button class="btn btn-primary" id="siguiente-norton">
                    Siguiente: Norton <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </section>
        
        <!-- Sección 4: Escala Norton -->
        <section id="norton" class="section">
            <h2 class="section-title"><i class="fas fa-bed"></i> Escala Norton</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Estado Físico</label>
                    <select id="norton-fisico" class="form-control">
                        <option value="4">Bueno (4 pts)</option>
                        <option value="3" selected>Regular (3 pts)</option>
                        <option value="2">Malo (2 pts)</option>
                        <option value="1">Muy malo (1 pts)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Estado Mental</label>
                    <select id="norton-mental" class="form-control">
                        <option value="4">Alerta (4 pts)</option>
                        <option value="3" selected>Apatía (3 pts)</option>
                        <option value="2">Confuso (2 pts)</option>
                        <option value="1">Estupor (1 pts)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Actividad</label>
                    <select id="norton-actividad" class="form-control">
                        <option value="4">Deambula (4 pts)</option>
                        <option value="3" selected>Deambula con ayuda (3 pts)</option>
                        <option value="2">Sillón (2 pts)</option>
                        <option value="1">Encamado (1 pts)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Movilidad</label>
                    <select id="norton-movilidad" class="form-control">
                        <option value="4">Completa (4 pts)</option>
                        <option value="3" selected>Ligeramente limitada (3 pts)</option>
                        <option value="2">Muy limitada (2 pts)</option>
                        <option value="1">Inmóvil (1 pts)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Incontinencia</label>
                    <select id="norton-incontinencia" class="form-control">
                        <option value="4">Ninguna (4 pts)</option>
                        <option value="3" selected>Ocasional (3 pts)</option>
                        <option value="2">Urinaria (2 pts)</option>
                        <option value="1">Urinaria y fecal (1 pts)</option>
                    </select>
                </div>
            </div>
            
            <div class="score-display">
                <div>Puntaje Total Norton</div>
                <div class="score-value" id="puntaje-norton">15</div>
                <div>Interpretación: 20-16 (Bajo riesgo) | 15-12 (Riesgo) | ≤11 (Alto riesgo)</div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-warning" id="volver-tinetti">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button class="btn btn-success" id="calcular-resultados">
                    <i class="fas fa-calculator"></i> Calcular Resultados
                </button>
            </div>
        </section>
        
        <!-- Sección 5: Resultados -->
        <section id="resultados" class="section">
            <h2 class="section-title"><i class="fas fa-chart-line"></i> Resultados Integrales</h2>
            
            <div id="contenido-resultados">
                <p style="text-align: center; color: #666; padding: 40px;">
                    Complete todas las secciones anteriores y haga clic en "Calcular Resultados"
                </p>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-warning" id="volver-norton">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button class="btn btn-primary" id="ir-compartir">
                    Compartir Resultados <i class="fas fa-share-alt"></i>
                </button>
            </div>
        </section>
        
        <!-- Sección 6: Compartir -->
        <section id="compartir" class="section">
            <h2 class="section-title"><i class="fas fa-share-alt"></i> Compartir Resultados</h2>
            
            <div class="info-box">
                <strong><i class="fas fa-info-circle"></i> Informe Profesional Detallado</strong>
                <p>Genere un informe completo con todos los datos de la evaluación, resultados detallados y recomendaciones personalizadas.</p>
            </div>
            
            <div class="share-options">
                <div class="share-card" id="generar-pdf">
                    <div class="share-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <h3>Generar PDF Profesional</h3>
                    <p>Informe detallado con todos los resultados</p>
                </div>
                
                <div class="share-card" id="compartir-whatsapp">
                    <div class="share-icon">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <h3>Compartir por WhatsApp</h3>
                    <p>Resumen profesional para equipo médico</p>
                </div>
                
                <div class="share-card" id="copiar-texto">
                    <div class="share-icon">
                        <i class="fas fa-copy"></i>
                    </div>
                    <h3>Copiar Informe</h3>
                    <p>Copiar informe completo al portapapeles</p>
                </div>
                
                <div class="share-card" id="nueva-evaluacion">
                    <div class="share-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <h3>Nueva Evaluación</h3>
                    <p>Empezar evaluación nueva</p>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-warning" id="volver-resultados">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
            </div>
        </section>
    </div>
    
    <!-- Notificación -->
    <div id="notification" class="notification"></div>

    <script>
        // Variables globales
        let puntajeTotalIRAT = 0;
        let puntajeNorton = 15;
        let puntajeTinetti = 0;
        let nivelRiesgoIRAT = "";
        let nivelRiesgoNorton = "";
        let recomendaciones = [];
        let datosCompletos = {};
        let tinettiNoEvaluable = false;
        let respuestasTinetti = {};

        // Configurar fecha actual por defecto
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').value = today;
            
            // Calcular Norton inicial
            calcularNorton();
            
            // Configurar navegación PRIMERO
            inicializarNavegacion();
            
            // Luego configurar otros componentes
            configurarTinetti();
            configurarIRAT5();
            configurarCompartir();
            
            mostrarNotificacion('Sistema de evaluación clínica cargado', 'info');
        });

        // ========== NAVEGACIÓN ==========
        function inicializarNavegacion() {
            // Navegación por pestañas
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const sectionId = this.getAttribute('data-section');
                    cambiarSeccion(sectionId);
                });
            });
            
            // Botones principales
            document.getElementById('siguiente-irat').addEventListener('click', function() {
                cambiarSeccion('evaluacion');
            });
            
            document.getElementById('volver-identificacion').addEventListener('click', function() {
                cambiarSeccion('identificacion');
            });
            
            document.getElementById('siguiente-tinetti').addEventListener('click', function() {
                cambiarSeccion('tinetti');
            });
            
            document.getElementById('volver-irat').addEventListener('click', function() {
                cambiarSeccion('evaluacion');
            });
            
            document.getElementById('siguiente-norton').addEventListener('click', function() {
                cambiarSeccion('norton');
            });
            
            document.getElementById('volver-tinetti').addEventListener('click', function() {
                cambiarSeccion('tinetti');
            });
            
            document.getElementById('calcular-resultados').addEventListener('click', function() {
                calcularResultadosCompletos();
            });
            
            document.getElementById('volver-norton').addEventListener('click', function() {
                cambiarSeccion('norton');
            });
            
            document.getElementById('ir-compartir').addEventListener('click', function() {
                if (Object.keys(datosCompletos).length > 0) {
                    cambiarSeccion('compartir');
                } else {
                    mostrarNotificacion('Primero debe calcular los resultados', 'error');
                }
            });
            
            document.getElementById('volver-resultados').addEventListener('click', function() {
                cambiarSeccion('resultados');
            });
        }
        
        function cambiarSeccion(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar la sección seleccionada
            const seccion = document.getElementById(sectionId);
            if (seccion) {
                seccion.classList.add('active');
            }
            
            // Actualizar pestañas activas
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-section') === sectionId) {
                    tab.classList.add('active');
                }
            });
            
            // Scroll al inicio
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ========== CONFIGURACIONES ==========
        function configurarIRAT5() {
            const selectsIRAT = ['equilibrio', 'amputacion', 'brazos', 'social', 'cooperacion'];
            
            selectsIRAT.forEach(id => {
                document.getElementById(id).addEventListener('change', function() {
                    calcularPuntajeIRATPreliminar();
                });
            });
            
            calcularPuntajeIRATPreliminar();
        }
        
        function calcularPuntajeIRATPreliminar() {
            let puntaje = 0;
            const selectsIRAT = ['equilibrio', 'amputacion', 'brazos', 'social', 'cooperacion'];
            
            selectsIRAT.forEach(id => {
                const select = document.getElementById(id);
                if (select.value) {
                    puntaje += parseInt(select.value);
                }
            });
            
            const amputacion = document.getElementById('amputacion').value;
            if (amputacion && parseInt(amputacion) >= 3) {
                puntaje += 1;
            }
            
            document.getElementById('puntaje-irat').textContent = puntaje;
        }
        
        function configurarTinetti() {
            // Opción "No evaluable"
            document.getElementById('opcion-no-evaluable').addEventListener('click', function() {
                document.querySelectorAll('.tinetti-option[data-grupo]').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                this.classList.add('selected');
                tinettiNoEvaluable = true;
                document.getElementById('test-tinetti-completo').style.display = 'none';
                mostrarResultadoTinetti();
            });
            
            // Opciones del test completo
            document.querySelectorAll('.tinetti-option[data-grupo]').forEach(option => {
                option.addEventListener('click', function() {
                    document.getElementById('opcion-no-evaluable').classList.remove('selected');
                    tinettiNoEvaluable = false;
                    document.getElementById('test-tinetti-completo').style.display = 'block';
                    
                    const grupo = this.getAttribute('data-grupo');
                    
                    document.querySelectorAll(`.tinetti-option[data-grupo="${grupo}"]`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    this.classList.add('selected');
                    
                    const puntaje = parseInt(this.getAttribute('data-puntaje'));
                    const texto = this.querySelector('strong') ? this.querySelector('strong').textContent : this.textContent;
                    respuestasTinetti[grupo] = {
                        texto: texto.trim(),
                        puntaje: puntaje
                    };
                    
                    calcularPuntajeTinetti();
                });
            });
        }
        
        function calcularPuntajeTinetti() {
            if (tinettiNoEvaluable) {
                puntajeTinetti = 0;
                mostrarResultadoTinetti();
                return;
            }
            
            let puntajeBalance = 0;
            let puntajeGait = 0;
            
            for (let i = 1; i <= 8; i++) {
                const grupo = `balance${i}`;
                if (respuestasTinetti[grupo]) {
                    puntajeBalance += respuestasTinetti[grupo].puntaje;
                }
            }
            
            for (let i = 9; i <= 16; i++) {
                const grupo = `gait${i}`;
                if (respuestasTinetti[grupo]) {
                    puntajeGait += respuestasTinetti[grupo].puntaje;
                }
            }
            
            puntajeTinetti = puntajeBalance + puntajeGait;
            mostrarResultadoTinetti();
        }
        
        function mostrarResultadoTinetti() {
            const resultadoDiv = document.getElementById('resultado-tinetti');
            
            if (tinettiNoEvaluable) {
                resultadoDiv.style.display = 'block';
                document.getElementById('puntaje-tinetti-total').textContent = 'No evaluable';
                document.getElementById('interpretacion-tinetti').innerHTML = '<strong>Máximo riesgo de caídas</strong>';
                document.getElementById('puntos-irat-tinetti').innerHTML = '<strong>4 puntos IRAT-5 (máximo)</strong>';
                return;
            }
            
            const gruposNecesarios = [];
            for (let i = 1; i <= 8; i++) gruposNecesarios.push(`balance${i}`);
            for (let i = 9; i <= 16; i++) gruposNecesarios.push(`gait${i}`);
            
            const todosCompletos = gruposNecesarios.every(grupo => respuestasTinetti[grupo]);
            
            if (!todosCompletos) {
                resultadoDiv.style.display = 'none';
                return;
            }
            
            let interpretacion = '';
            let puntosIRAT = 0;
            
            if (puntajeTinetti >= 25) {
                interpretacion = '<strong>Bajo riesgo de caídas</strong>';
                puntosIRAT = 0;
            } else if (puntajeTinetti >= 19) {
                interpretacion = '<strong>Riesgo moderado de caídas</strong>';
                puntosIRAT = 2;
            } else {
                interpretacion = '<strong>Alto riesgo de caídas</strong>';
                puntosIRAT = 4;
            }
            
            resultadoDiv.style.display = 'block';
            document.getElementById('puntaje-tinetti-total').textContent = puntajeTinetti;
            document.getElementById('interpretacion-tinetti').innerHTML = interpretacion;
            document.getElementById('puntos-irat-tinetti').innerHTML = `<strong>${puntosIRAT} puntos IRAT-5</strong>`;
        }
        
        function calcularNorton() {
            let puntaje = 0;
            const selectsNorton = ['norton-fisico', 'norton-mental', 'norton-actividad', 'norton-movilidad', 'norton-incontinencia'];
            
            selectsNorton.forEach(id => {
                const select = document.getElementById(id);
                puntaje += parseInt(select.value);
            });
            
            puntajeNorton = puntaje;
            document.getElementById('puntaje-norton').textContent = puntaje;
        }
        
        function configurarCompartir() {
            document.getElementById('generar-pdf').addEventListener('click', generarPDFProfesional);
            document.getElementById('compartir-whatsapp').addEventListener('click', compartirWhatsAppProfesional);
            document.getElementById('copiar-texto').addEventListener('click', copiarInformeCompleto);
            document.getElementById('nueva-evaluacion').addEventListener('click', nuevaEvaluacion);
        }

        // ========== CÁLCULO DE RESULTADOS ==========
        function calcularResultadosCompletos() {
            // Calcular puntaje IRAT-5 completo (con Tinetti)
            let puntajeIRAT = 0;
            const selectsIRAT = ['equilibrio', 'amputacion', 'brazos', 'social', 'cooperacion'];
            
            selectsIRAT.forEach(id => {
                const select = document.getElementById(id);
                if (select.value) {
                    puntajeIRAT += parseInt(select.value);
                }
            });
            
            const amputacion = document.getElementById('amputacion').value;
            if (amputacion && parseInt(amputacion) >= 3) {
                puntajeIRAT += 1;
            }
            
            let puntosTinettiIRAT = 0;
            
            if (tinettiNoEvaluable) {
                puntosTinettiIRAT = 4;
            } else if (puntajeTinetti >= 25) {
                puntosTinettiIRAT = 0;
            } else if (puntajeTinetti >= 19) {
                puntosTinettiIRAT = 2;
            } else {
                puntosTinettiIRAT = 4;
            }
            
            puntajeTotalIRAT = puntajeIRAT + puntosTinettiIRAT;
            
            // Determinar nivel de riesgo IRAT-5
            if (puntajeTotalIRAT <= 6) {
                nivelRiesgoIRAT = "BAJO RIESGO";
            } else if (puntajeTotalIRAT <= 9) {
                nivelRiesgoIRAT = "RIESGO MODERADO";
            } else if (puntajeTotalIRAT <= 12) {
                nivelRiesgoIRAT = "ALTO RIESGO";
            } else {
                nivelRiesgoIRAT = "MUY ALTO RIESGO";
            }
            
            // Determinar nivel de riesgo Norton
            if (puntajeNorton >= 16) {
                nivelRiesgoNorton = "BAJO RIESGO Úlceras por presión";
            } else if (puntajeNorton >= 12) {
                nivelRiesgoNorton = "RIESGO MODERADO Úlceras por presión";
            } else {
                nivelRiesgoNorton = "ALTO RIESGO Úlceras por presión";
            }
            
            // Generar recomendaciones
            recomendaciones = generarRecomendaciones();
            
            // Recopilar todos los datos
            recopilarDatosCompletos();
            
            // Mostrar resultados
            mostrarResultados();
            
            cambiarSeccion('resultados');
            
            mostrarNotificacion('Resultados calculados exitosamente', 'success');
        }
        
        function recopilarDatosCompletos() {
            datosCompletos = {
                paciente: {
                    nombre: document.getElementById('nombre').value,
                    rut: document.getElementById('rut').value,
                    edad: document.getElementById('edad').value,
                    fecha: document.getElementById('fecha').value,
                    sexo: document.getElementById('sexo').value,
                    evaluador: document.getElementById('evaluador').value,
                    institucion: document.getElementById('institucion').value,
                    historiaClinica: document.getElementById('historia-clinica').value
                },
                
                irat5: {
                    equilibrio: obtenerTextoOpcion('equilibrio'),
                    amputacion: obtenerTextoOpcion('amputacion'),
                    brazos: obtenerTextoOpcion('brazos'),
                    social: obtenerTextoOpcion('social'),
                    cooperacion: obtenerTextoOpcion('cooperacion'),
                    puntaje: puntajeTotalIRAT,
                    riesgo: nivelRiesgoIRAT
                },
                
                tinetti: {
                    evaluable: !tinettiNoEvaluable,
                    puntaje: tinettiNoEvaluable ? 'No evaluable' : puntajeTinetti,
                    riesgo: tinettiNoEvaluable ? 'Máximo riesgo (No evaluable)' : 
                           puntajeTinetti >= 25 ? 'Bajo riesgo caídas' : 
                           puntajeTinetti >= 19 ? 'Riesgo moderado caídas' : 'Alto riesgo caídas',
                    detalleEquilibrio: obtenerDetalleTinetti('balance'),
                    detalleMarcha: obtenerDetalleTinetti('gait')
                },
                
                norton: {
                    fisico: obtenerTextoOpcion('norton-fisico'),
                    mental: obtenerTextoOpcion('norton-mental'),
                    actividad: obtenerTextoOpcion('norton-actividad'),
                    movilidad: obtenerTextoOpcion('norton-movilidad'),
                    incontinencia: obtenerTextoOpcion('norton-incontinencia'),
                    puntaje: puntajeNorton,
                    riesgo: nivelRiesgoNorton
                },
                
                resultados: {
                    fechaCalculo: new Date().toLocaleString('es-ES'),
                    proximaEvaluacion: obtenerProximaFechaEvaluacion(),
                    recomendaciones: recomendaciones
                }
            };
        }
        
        function obtenerDetalleTinetti(tipo) {
            let detalle = '';
            const grupos = tipo === 'balance' ? 
                ['balance1', 'balance2', 'balance3', 'balance4', 'balance5', 'balance6', 'balance7', 'balance8'] :
                ['gait9', 'gait10', 'gait11', 'gait12', 'gait13', 'gait14', 'gait15', 'gait16'];
            
            grupos.forEach(grupo => {
                if (respuestasTinetti[grupo]) {
                    detalle += `• ${respuestasTinetti[grupo].texto}\n`;
                }
            });
            
            return detalle;
        }
        
        function obtenerTextoOpcion(idSelect) {
            const select = document.getElementById(idSelect);
            if (!select || !select.value) return 'No seleccionado';
            
            const selectedOption = select.options[select.selectedIndex];
            return selectedOption.text.split('(')[0].trim();
        }
        
        function generarRecomendaciones() {
            const recs = [];
            
            // Recomendaciones por nivel de riesgo IRAT-5
            if (puntajeTotalIRAT <= 6) {
                recs.push("Bastón simple si es necesario para mayor seguridad");
                recs.push("Ejercicios de equilibrio básicos");
                recs.push("Revisión domiciliaria básica de seguridad");
                recs.push("Seguimiento cada 6 meses");
            } else if (puntajeTotalIRAT <= 9) {
                recs.push("Andador con 2 o 4 ruedas para mayor estabilidad");
                recs.push("Cojín antiescaras para silla o sillón");
                recs.push("Instalación de barras de apoyo en baño");
                recs.push("Programa de ejercicios de fortalecimiento");
                recs.push("Evaluación por terapia ocupacional");
            } else if (puntajeTotalIRAT <= 12) {
                recs.push("Andador fijo (sin ruedas) para máxima estabilidad");
                recs.push("Colchón estático de alta densidad");
                recs.push("Supervisión durante la deambulación");
                recs.push("Adaptaciones domiciliarias prioritarias");
                recs.push("Entrenamiento básico para cuidadores");
            } else {
                recs.push("Silla de ruedas adaptada con cojín antiescaras");
                recs.push("Colchón alternante de aire para prevención UPP");
                recs.push("Plan de movilización cada 2-3 horas");
                recs.push("Valoración por equipo multidisciplinar");
                recs.push("Entrenamiento formal para cuidadores");
                recs.push("Modificaciones estructurales en domicilio");
            }
            
            return recs;
        }
        
        function obtenerProximaFechaEvaluacion() {
            const fecha = new Date();
            fecha.setMonth(fecha.getMonth() + 3);
            return fecha.toLocaleDateString('es-ES', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric' 
            });
        }
        
        function mostrarResultados() {
            const riesgoColorIRAT = nivelRiesgoIRAT.includes("BAJO") ? "risk-low" :
                                   nivelRiesgoIRAT.includes("MODERADO") ? "risk-moderate" :
                                   nivelRiesgoIRAT.includes("ALTO") ? "risk-high" : "risk-very-high";
            
            const riesgoColorNorton = nivelRiesgoNorton.includes("BAJO") ? "risk-low" :
                                     nivelRiesgoNorton.includes("MODERADO") ? "risk-moderate" : "risk-high";
            
            let riesgoTinettiHTML = '';
            if (tinettiNoEvaluable) {
                riesgoTinettiHTML = '<strong>NO EVALUABLE - MÁXIMO RIESGO</strong>';
            } else {
                const riesgoTinetti = puntajeTinetti >= 25 ? "Bajo riesgo de caídas" :
                                     puntajeTinetti >= 19 ? "Riesgo moderado de caídas" : "Alto riesgo de caídas";
                riesgoTinettiHTML = `<strong>${riesgoTinetti}</strong> (${puntajeTinetti}/28)`;
            }
            
            const html = `
                <div class="informe-profesional">
                    <div class="cabecera-informe">
                        <div class="logo-informe">
                            <i class="fas fa-hospital-alt"></i>
                        </div>
                        <h2 class="titulo-informe">Informe de Evaluación Clínica</h2>
                        <p class="subtitulo-informe">IRAT-5 Modificado + Test de Tinetti + Escala Norton</p>
                    </div>
                    
                    <div class="seccion-informe">
                        <h3><i class="fas fa-user"></i> Datos del Paciente</h3>
                        <div class="resultados-detallados">
                            <div class="resultado-item">
                                <span class="resultado-label">Nombre:</span>
                                <span class="resultado-valor">${datosCompletos.paciente.nombre || "No especificado"}</span>
                            </div>
                            <div class="resultado-item">
                                <span class="resultado-label">Identificación:</span>
                                <span class="resultado-valor">${datosCompletos.paciente.rut || "No especificado"}</span>
                            </div>
                            <div class="resultado-item">
                                <span class="resultado-label">Edad:</span>
                                <span class="resultado-valor">${datosCompletos.paciente.edad || "No especificado"} años</span>
                            </div>
                            <div class="resultado-item">
                                <span class="resultado-label">Sexo:</span>
                                <span class="resultado-valor">${datosCompletos.paciente.sexo || "No especificado"}</span>
                            </div>
                            <div class="resultado-item">
                                <span class="resultado-label">Fecha evaluación:</span>
                                <span class="resultado-valor">${datosCompletos.paciente.fecha || "No especificado"}</span>
                            </div>
                            <div class="resultado-item">
                                <span class="resultado-label">Evaluador:</span>
                                <span class="resultado-valor">${datosCompletos.paciente.evaluador || "No especificado"}</span>
                            </div>
                            <div class="resultado-item">
                                <span class="resultado-label">Institución:</span>
                                <span class="resultado-valor">${datosCompletos.paciente.institucion || "No especificado"}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="seccion-informe">
                        <h3><i class="fas fa-chart-bar"></i> Resultados de las Evaluaciones</h3>
                        
                        <div class="score-display">
                            <div>Puntaje Total IRAT-5 Modificado</div>
                            <div class="score-value">${puntajeTotalIRAT}</div>
                            <div>Puntos de corte: 0-6 (Bajo) | 7-9 (Moderado) | 10-12 (Alto) | ≥13 (Muy Alto)</div>
                        </div>
                        
                        <div class="risk-level ${riesgoColorIRAT}">
                            <h3 style="margin-bottom: 10px;">${nivelRiesgoIRAT}</h3>
                            <p>${obtenerDescripcionRiesgoIRAT()}</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 25px;">
                            <div>
                                <div class="score-display" style="margin: 0;">
                                    <div>Test de Tinetti</div>
                                    <div class="score-value">${tinettiNoEvaluable ? 'NE' : puntajeTinetti}${tinettiNoEvaluable ? '' : '/28'}</div>
                                    <div>${riesgoTinettiHTML}</div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="score-display" style="margin: 0;">
                                    <div>Escala Norton</div>
                                    <div class="score-value">${puntajeNorton}</div>
                                    <div>${nivelRiesgoNorton}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="seccion-informe">
                        <h3><i class="fas fa-clipboard-check"></i> Detalle de Evaluaciones</h3>
                        
                        <table class="tabla-informe">
                            <thead>
                                <tr>
                                    <th>Evaluación</th>
                                    <th>Resultado</th>
                                    <th>Interpretación</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>IRAT-5 Modificado</strong></td>
                                    <td>${puntajeTotalIRAT} puntos</td>
                                    <td>${nivelRiesgoIRAT}</td>
                                </tr>
                                <tr>
                                    <td><strong>Test de Tinetti</strong></td>
                                    <td>${tinettiNoEvaluable ? 'No evaluable' : puntajeTinetti + '/28 puntos'}</td>
                                    <td>${datosCompletos.tinetti.riesgo}</td>
                                </tr>
                                <tr>
                                    <td><strong>Escala Norton</strong></td>
                                    <td>${puntajeNorton} puntos</td>
                                    <td>${nivelRiesgoNorton}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="seccion-informe">
                        <h3><i class="fas fa-prescription-bottle-alt"></i> Recomendaciones Integrales</h3>
                        
                        <div class="recommendations-grid">
                            ${recomendaciones.map((rec, index) => `
                                <div class="recommendation-card">
                                    <div style="font-weight: 600; color: var(--primary-color);">
                                        <i class="fas fa-check-circle"></i> Recomendación ${index + 1}
                                    </div>
                                    <p style="margin-top: 8px;">${rec}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="seccion-informe">
                        <h3><i class="fas fa-calendar-check"></i> Plan de Seguimiento</h3>
                        <div class="info-box">
                            <p><strong>Próxima evaluación recomendada:</strong> ${obtenerProximaFechaEvaluacion()}</p>
                            <p><strong>Fecha de este informe:</strong> ${new Date().toLocaleDateString('es-ES', { 
                                day: '2-digit', 
                                month: 'long', 
                                year: 'numeric' 
                            })}</p>
                        </div>
                    </div>
                    
                    <div class="firma-informe">
                        <p><strong>Nota:</strong> Este informe es una guía clínica y debe ser interpretado por profesionales capacitados.</p>
                        <p style="margin-top: 30px; text-align: right;">
                            <strong>Profesional evaluador:</strong><br>
                            ${datosCompletos.paciente.evaluador || "No especificado"}
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('contenido-resultados').innerHTML = html;
        }
        
        function obtenerDescripcionRiesgoIRAT() {
            if (puntajeTotalIRAT <= 6) return "Ayudas básicas o ninguna. Bastón simple o sin ayuda.";
            if (puntajeTotalIRAT <= 9) return "Ayudas intermedias. Andador con ruedas + cojín antiescaras.";
            if (puntajeTotalIRAT <= 12) return "Ayudas avanzadas. Andador fijo + colchón estático.";
            return "Ayudas de movilización. Silla de ruedas + colchón alternante.";
        }

        // ========== FUNCIONALIDADES DE COMPARTIR PROFESIONALES ==========
        async function generarPDFProfesional() {
            try {
                if (!datosCompletos.paciente || !datosCompletos.paciente.nombre) {
                    mostrarNotificacion('Primero calcule los resultados', 'error');
                    return;
                }
                
                mostrarNotificacion('Generando informe PDF profesional...', 'info');
                
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                let yPos = 20;
                
                // ===== PORTADA =====
                pdf.setFontSize(22);
                pdf.setTextColor(30, 60, 114);
                pdf.text("INFORME DE EVALUACIÓN CLÍNICA", 105, yPos, { align: 'center' });
                yPos += 10;
                
                pdf.setFontSize(18);
                pdf.setTextColor(42, 82, 152);
                pdf.text("IRAT-5 Modificado + Tinetti + Norton", 105, yPos, { align: 'center' });
                yPos += 15;
                
                pdf.setDrawColor(30, 60, 114);
                pdf.setLineWidth(0.5);
                pdf.line(20, yPos, 190, yPos);
                yPos += 20;
                
                // Logo/símbolo
                pdf.setFontSize(14);
                pdf.text("🏥", 105, yPos, { align: 'center' });
                yPos += 10;
                
                pdf.setFontSize(12);
                pdf.setTextColor(100, 100, 100);
                pdf.text("Documento Confidencial - Uso Profesional", 105, yPos, { align: 'center' });
                yPos += 10;
                
                pdf.text(`Fecha de emisión: ${new Date().toLocaleDateString('es-ES')}`, 105, yPos, { align: 'center' });
                yPos += 30;
                
                pdf.setFontSize(16);
                pdf.setTextColor(30, 60, 114);
                pdf.text("RESUMEN EJECUTIVO", 105, yPos, { align: 'center' });
                yPos += 15;
                
                pdf.setFontSize(12);
                pdf.setTextColor(0, 0, 0);
                pdf.text(`Paciente: ${datosCompletos.paciente.nombre}`, 20, yPos);
                yPos += 8;
                pdf.text(`Evaluador: ${datosCompletos.paciente.evaluador}`, 20, yPos);
                yPos += 8;
                pdf.text(`Institución: ${datosCompletos.paciente.institucion || 'No especificada'}`, 20, yPos);
                yPos += 8;
                pdf.text(`Fecha evaluación: ${datosCompletos.paciente.fecha}`, 20, yPos);
                yPos += 15;
                
                // Resultados resumidos
                pdf.setFontSize(14);
                pdf.setTextColor(30, 60, 114);
                pdf.text("RESULTADOS PRINCIPALES", 20, yPos);
                yPos += 10;
                
                pdf.setFontSize(11);
                pdf.setTextColor(0, 0, 0);
                pdf.text(`• IRAT-5 Modificado: ${puntajeTotalIRAT} puntos - ${nivelRiesgoIRAT}`, 25, yPos);
                yPos += 7;
                pdf.text(`• Test de Tinetti: ${tinettiNoEvaluable ? 'No evaluable' : puntajeTinetti + '/28'} - ${datosCompletos.tinetti.riesgo}`, 25, yPos);
                yPos += 7;
                pdf.text(`• Escala Norton: ${puntajeNorton} puntos - ${nivelRiesgoNorton}`, 25, yPos);
                
                // Nueva página para detalles
                pdf.addPage();
                yPos = 20;
                
                // ===== DETALLE COMPLETO =====
                pdf.setFontSize(16);
                pdf.setTextColor(30, 60, 114);
                pdf.text("DETALLE COMPLETO DE LA EVALUACIÓN", 20, yPos);
                yPos += 15;
                
                // Datos del paciente
                pdf.setFontSize(12);
                pdf.setTextColor(42, 82, 152);
                pdf.text("1. DATOS DEL PACIENTE", 20, yPos);
                yPos += 10;
                
                pdf.setFontSize(10);
                pdf.setTextColor(0, 0, 0);
                const datosPacientePDF = [
                    ['Nombre completo:', datosCompletos.paciente.nombre],
                    ['Identificación:', datosCompletos.paciente.rut || 'No especificado'],
                    ['Edad:', datosCompletos.paciente.edad ? datosCompletos.paciente.edad + ' años' : 'No especificado'],
                    ['Sexo:', datosCompletos.paciente.sexo || 'No especificado'],
                    ['Institución:', datosCompletos.paciente.institucion || 'No especificado'],
                    ['Historia clínica:', datosCompletos.paciente.historiaClinica || 'No especificada'],
                    ['Evaluador:', datosCompletos.paciente.evaluador],
                    ['Fecha evaluación:', datosCompletos.paciente.fecha]
                ];
                
                datosPacientePDF.forEach(([label, value]) => {
                    pdf.text(`${label} ${value}`, 25, yPos);
                    yPos += 6;
                });
                
                yPos += 10;
                
                // IRAT-5 detallado
                pdf.setFontSize(12);
                pdf.setTextColor(42, 82, 152);
                pdf.text("2. IRAT-5 MODIFICADO", 20, yPos);
                yPos += 10;
                
                pdf.setFontSize(10);
                const tablaIRAT = [
                    ['Variable', 'Respuesta', 'Puntos'],
                    ['Equilibrio unipodal', datosCompletos.irat5.equilibrio, obtenerPuntosSelect('equilibrio')],
                    ['Tipo de amputación', datosCompletos.irat5.amputacion, obtenerPuntosSelect('amputacion') + 
                     (parseInt(document.getElementById('amputacion').value) >= 3 ? ' + 1 riesgo' : '')],
                    ['Función de brazos', datosCompletos.irat5.brazos, obtenerPuntosSelect('brazos')],
                    ['Situación social', datosCompletos.irat5.social, obtenerPuntosSelect('social')],
                    ['Cooperación', datosCompletos.irat5.cooperacion, obtenerPuntosSelect('cooperacion')],
                    ['', 'PUNTAJE TOTAL IRAT-5', puntajeTotalIRAT + ' puntos'],
                    ['', 'NIVEL DE RIESGO', nivelRiesgoIRAT]
                ];
                
                // Dibujar tabla IRAT-5
                let tableY = yPos;
                tablaIRAT.forEach((row, rowIndex) => {
                    const isHeader = rowIndex === 0;
                    const isTotal = rowIndex >= tablaIRAT.length - 2;
                    
                    pdf.setFont(isHeader || isTotal ? 'helvetica' : 'helvetica');
                    pdf.setFontStyle(isHeader || isTotal ? 'bold' : 'normal');
                    
                    pdf.text(row[0], 25, tableY);
                    pdf.text(row[1], 80, tableY);
                    pdf.text(row[2], 160, tableY, { align: 'right' });
                    
                    tableY += 7;
                });
                
                yPos = tableY + 10;
                
                // Si se acerca al final de página, nueva página
                if (yPos > 250) {
                    pdf.addPage();
                    yPos = 20;
                }
                
                // Tinetti
                pdf.setFontSize(12);
                pdf.setTextColor(42, 82, 152);
                pdf.text("3. TEST DE TINETTI", 20, yPos);
                yPos += 10;
                
                pdf.setFontSize(10);
                if (tinettiNoEvaluable) {
                    pdf.text("No evaluable - Paciente no puede realizar la prueba", 25, yPos);
                    yPos += 7;
                    pdf.text("Máximo riesgo de caídas - 4 puntos IRAT-5", 25, yPos);
                } else {
                    pdf.text(`Puntaje total: ${puntajeTinetti}/28 puntos`, 25, yPos);
                    yPos += 7;
                    pdf.text(`Interpretación: ${datosCompletos.tinetti.riesgo}`, 25, yPos);
                    yPos += 7;
                    pdf.text(`Puntos IRAT-5 asignados: ${puntajeTinetti >= 25 ? 0 : puntajeTinetti >= 19 ? 2 : 4}`, 25, yPos);
                }
                
                yPos += 15;
                
                // Norton
                pdf.setFontSize(12);
                pdf.setTextColor(42, 82, 152);
                pdf.text("4. ESCALA NORTON", 20, yPos);
                yPos += 10;
                
                const tablaNorton = [
                    ['Variable', 'Valoración', 'Puntos'],
                    ['Estado físico', datosCompletos.norton.fisico, document.getElementById('norton-fisico').value],
                    ['Estado mental', datosCompletos.norton.mental, document.getElementById('norton-mental').value],
                    ['Actividad', datosCompletos.norton.actividad, document.getElementById('norton-actividad').value],
                    ['Movilidad', datosCompletos.norton.movilidad, document.getElementById('norton-movilidad').value],
                    ['Incontinencia', datosCompletos.norton.incontinencia, document.getElementById('norton-incontinencia').value],
                    ['', 'PUNTAJE TOTAL NORTON', puntajeNorton + ' puntos'],
                    ['', 'RIESGO ÚLCERAS', nivelRiesgoNorton]
                ];
                
                tableY = yPos;
                tablaNorton.forEach((row, rowIndex) => {
                    const isHeader = rowIndex === 0;
                    const isTotal = rowIndex >= tablaNorton.length - 2;
                    
                    pdf.setFontStyle(isHeader || isTotal ? 'bold' : 'normal');
                    
                    pdf.text(row[0], 25, tableY);
                    pdf.text(row[1], 80, tableY);
                    pdf.text(row[2], 160, tableY, { align: 'right' });
                    
                    tableY += 7;
                });
                
                yPos = tableY + 15;
                
                // Nueva página para recomendaciones
                pdf.addPage();
                yPos = 20;
                
                // ===== RECOMENDACIONES =====
                pdf.setFontSize(16);
                pdf.setTextColor(30, 60, 114);
                pdf.text("5. RECOMENDACIONES Y PLAN DE INTERVENCIÓN", 20, yPos);
                yPos += 15;
                
                pdf.setFontSize(12);
                pdf.setTextColor(0, 0, 0);
                pdf.text("Recomendaciones específicas basadas en los resultados:", 20, yPos);
                yPos += 10;
                
                pdf.setFontSize(10);
                recomendaciones.forEach((rec, index) => {
                    if (yPos > 270) {
                        pdf.addPage();
                        yPos = 20;
                    }
                    pdf.text(`${index + 1}. ${rec}`, 25, yPos);
                    yPos += 7;
                });
                
                yPos += 10;
                
                // Plan de seguimiento
                pdf.setFontSize(12);
                pdf.setTextColor(42, 82, 152);
                pdf.text("Plan de Seguimiento", 20, yPos);
                yPos += 10;
                
                pdf.setFontSize(10);
                pdf.setTextColor(0, 0, 0);
                pdf.text(`• Próxima evaluación recomendada: ${obtenerProximaFechaEvaluacion()}`, 25, yPos);
                yPos += 7;
                pdf.text(`• Frecuencia de reevaluación: ${puntajeTotalIRAT <= 6 ? 'Cada 6 meses' : puntajeTotalIRAT <= 12 ? 'Cada 3 meses' : 'Cada mes'}`, 25, yPos);
                yPos += 7;
                pdf.text("• Monitoreo continuo de cambios en estado funcional", 25, yPos);
                
                yPos += 20;
                
                // Observaciones
                pdf.setFontSize(10);
                pdf.setTextColor(100, 100, 100);
                pdf.text("Observaciones: Este informe debe ser complementado con evaluación clínica integral.", 20, yPos);
                yPos += 6;
                pdf.text("Las recomendaciones deben individualizarse según evolución y contexto del paciente.", 20, yPos);
                
                yPos += 20;
                
                // ===== FIRMAS =====
                pdf.setFontSize(12);
                pdf.setTextColor(30, 60, 114);
                pdf.text("FIRMAS", 20, yPos);
                yPos += 15;
                
                // Firma profesional
                pdf.setFontSize(10);
                pdf.setTextColor(0, 0, 0);
                pdf.text("_________________________________________", 20, yPos);
                yPos += 7;
                pdf.text("Firma del profesional evaluador", 20, yPos);
                yPos += 7;
                pdf.text(`Nombre: ${datosCompletos.paciente.evaluador}`, 20, yPos);
                yPos += 7;
                pdf.text("Colegio/Registro profesional: _____________________", 20, yPos);
                yPos += 20;
                
                // Firma paciente/familiar
                pdf.text("_________________________________________", 20, yPos);
                yPos += 7;
                pdf.text("Firma del paciente o representante legal", 20, yPos);
                yPos += 7;
                pdf.text(`Nombre: ${datosCompletos.paciente.nombre}`, 20, yPos);
                yPos += 7;
                pdf.text(`Fecha: ${new Date().toLocaleDateString('es-ES')}`, 20, yPos);
                
                // Pie de página final
                pdf.setFontSize(8);
                pdf.setTextColor(150, 150, 150);
                pdf.text("Documento generado por Sistema IRAT-5 + Tinetti + Norton - Versión Profesional", 105, 285, { align: 'center' });
                pdf.text(`ID: ${Date.now()} - ${datosCompletos.paciente.nombre.substring(0, 3).toUpperCase()}`, 105, 290, { align: 'center' });
                
                // Guardar PDF
                const nombreArchivo = `Informe_${datosCompletos.paciente.nombre.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                pdf.save(nombreArchivo);
                
                mostrarNotificacion('Informe PDF profesional generado exitosamente', 'success');
                
            } catch (error) {
                console.error('Error al generar PDF:', error);
                mostrarNotificacion('Error al generar PDF: ' + error.message, 'error');
            }
        }
        
        function obtenerPuntosSelect(id) {
            const select = document.getElementById(id);
            return select && select.value ? select.value : '0';
        }
        
        function compartirWhatsAppProfesional() {
            if (!datosCompletos.paciente || !datosCompletos.paciente.nombre) {
                mostrarNotificacion('Primero calcule los resultados', 'error');
                return;
            }
            
            const mensaje = `*INFORME DE EVALUACIÓN CLÍNICA*%0A%0A` +
                           `*Paciente:* ${datosCompletos.paciente.nombre}%0A` +
                           `*Fecha:* ${datosCompletos.paciente.fecha}%0A` +
                           `*Evaluador:* ${datosCompletos.paciente.evaluador}%0A%0A` +
                           `*RESULTADOS:*%0A` +
                           `• IRAT-5: ${puntajeTotalIRAT} pts - ${nivelRiesgoIRAT}%0A` +
                           `• Tinetti: ${tinettiNoEvaluable ? 'No evaluable' : puntajeTinetti + '/28'} - ${datosCompletos.tinetti.riesgo}%0A` +
                           `• Norton: ${puntajeNorton} pts - ${nivelRiesgoNorton}%0A%0A` +
                           `*RECOMENDACIONES PRINCIPALES:*%0A` +
                           `${recomendaciones.slice(0, 3).map(r => `• ${r}`).join('%0A')}%0A%0A` +
                           `*Próxima evaluación:* ${obtenerProximaFechaEvaluacion()}%0A` +
                           `*Informe completo disponible en PDF*`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(mensaje)}`, '_blank');
            mostrarNotificacion('Compartiendo por WhatsApp...', 'info');
        }
        
        function copiarInformeCompleto() {
            if (!datosCompletos.paciente || !datosCompletos.paciente.nombre) {
                mostrarNotificacion('Primero calcule los resultados', 'error');
                return;
            }
            
            const informe = `INFORME DE EVALUACIÓN CLÍNICA PROFESIONAL
================================================================

DATOS DEL PACIENTE
------------------
Nombre: ${datosCompletos.paciente.nombre}
Identificación: ${datosCompletos.paciente.rut || 'No especificado'}
Edad: ${datosCompletos.paciente.edad || 'No especificado'} años
Sexo: ${datosCompletos.paciente.sexo || 'No especificado'}
Institución: ${datosCompletos.paciente.institucion || 'No especificado'}
Evaluador: ${datosCompletos.paciente.evaluador}
Fecha evaluación: ${datosCompletos.paciente.fecha}
Historia clínica: ${datosCompletos.paciente.historiaClinica || 'No especificada'}

RESULTADOS DE EVALUACIONES
--------------------------
1. IRAT-5 MODIFICADO
   Puntaje total: ${puntajeTotalIRAT} puntos
   Nivel de riesgo: ${nivelRiesgoIRAT}
   Detalle:
   • Equilibrio: ${datosCompletos.irat5.equilibrio}
   • Amputación: ${datosCompletos.irat5.amputacion}
   • Brazos: ${datosCompletos.irat5.brazos}
   • Situación social: ${datosCompletos.irat5.social}
   • Cooperación: ${datosCompletos.irat5.cooperacion}

2. TEST DE TINETTI
   ${tinettiNoEvaluable ? 'No evaluable - Máximo riesgo' : `Puntaje: ${puntajeTinetti}/28 puntos`}
   Interpretación: ${datosCompletos.tinetti.riesgo}
   Puntos IRAT-5 asignados: ${tinettiNoEvaluable ? 4 : puntajeTinetti >= 25 ? 0 : puntajeTinetti >= 19 ? 2 : 4}

3. ESCALA NORTON
   Puntaje total: ${puntajeNorton} puntos
   Nivel de riesgo: ${nivelRiesgoNorton}
   Detalle:
   • Estado físico: ${datosCompletos.norton.fisico}
   • Estado mental: ${datosCompletos.norton.mental}
   • Actividad: ${datosCompletos.norton.actividad}
   • Movilidad: ${datosCompletos.norton.movilidad}
   • Incontinencia: ${datosCompletos.norton.incontinencia}

RECOMENDACIONES INTEGRALES
--------------------------
${recomendaciones.map((r, i) => `${i + 1}. ${r}`).join('\n')}

PLAN DE SEGUIMIENTO
-------------------
• Próxima evaluación recomendada: ${obtenerProximaFechaEvaluacion()}
• Frecuencia de reevaluación: ${puntajeTotalIRAT <= 6 ? 'Cada 6 meses' : puntajeTotalIRAT <= 12 ? 'Cada 3 meses' : 'Cada mes'}
• Consideraciones especiales: ${tinettiNoEvaluable ? 'Paciente no evaluable en Tinetti - Máximo riesgo de caídas' : 'Seguimiento según evolución'}

FIRMAS
------
Profesional evaluador: ${datosCompletos.paciente.evaluador}
Paciente/Representante: _________________________

Fecha de emisión: ${new Date().toLocaleDateString('es-ES')}
Documento confidencial - Uso profesional exclusivo
================================================================
Sistema IRAT-5 + Tinetti + Norton - Evaluación Clínica Integral`;

            navigator.clipboard.writeText(informe)
                .then(() => mostrarNotificacion('Informe copiado al portapapeles', 'success'))
                .catch(() => {
                    const textarea = document.createElement('textarea');
                    textarea.value = informe;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    mostrarNotificacion('Informe copiado al portapapeles', 'success');
                });
        }
        
        function nuevaEvaluacion() {
            if (confirm('¿Está seguro de comenzar una nueva evaluación? Se perderán los datos actuales.')) {
                // Limpiar formularios
                document.getElementById('nombre').value = '';
                document.getElementById('rut').value = '';
                document.getElementById('edad').value = '';
                document.getElementById('fecha').value = new Date().toISOString().split('T')[0];
                document.getElementById('sexo').value = '';
                document.getElementById('evaluador').value = '';
                document.getElementById('institucion').value = '';
                document.getElementById('historia-clinica').value = '';
                
                ['equilibrio', 'amputacion', 'brazos', 'social', 'cooperacion'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                document.getElementById('puntaje-irat').textContent = '0';
                
                document.querySelectorAll('.tinetti-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                document.getElementById('test-tinetti-completo').style.display = 'block';
                document.getElementById('resultado-tinetti').style.display = 'none';
                tinettiNoEvaluable = false;
                respuestasTinetti = {};
                
                document.getElementById('norton-fisico').value = '3';
                document.getElementById('norton-mental').value = '3';
                document.getElementById('norton-actividad').value = '3';
                document.getElementById('norton-movilidad').value = '3';
                document.getElementById('norton-incontinencia').value = '3';
                document.getElementById('puntaje-norton').textContent = '15';
                
                document.getElementById('contenido-resultados').innerHTML = `
                    <p style="text-align: center; color: #666; padding: 40px;">
                        Complete todas las secciones anteriores y haga clic en "Calcular Resultados"
                    </p>
                `;
                
                puntajeTotalIRAT = 0;
                puntajeNorton = 15;
                puntajeTinetti = 0;
                nivelRiesgoIRAT = "";
                nivelRiesgoNorton = "";
                recomendaciones = [];
                datosCompletos = {};
                
                cambiarSeccion('identificacion');
                
                mostrarNotificacion('Nueva evaluación lista', 'success');
            }
        }
        
        function mostrarNotificacion(mensaje, tipo) {
            const notificacion = document.getElementById('notification');
            notificacion.textContent = mensaje;
            notificacion.className = `notification ${tipo}`;
            notificacion.style.display = 'block';
            
            setTimeout(() => {
                notificacion.style.display = 'none';
            }, 4000);
        }
        
        // Configurar eventos de cambio para Norton
        document.addEventListener('DOMContentLoaded', function() {
            const selectsNorton = ['norton-fisico', 'norton-mental', 'norton-actividad', 'norton-movilidad', 'norton-incontinencia'];
            
            selectsNorton.forEach(id => {
                document.getElementById(id).addEventListener('change', calcularNorton);
            });
        });
    </script>
</body>
                                                                  </html>
