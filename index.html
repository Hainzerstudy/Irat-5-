<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Evaluaci√≥n Cl√≠nica IRAT-5</title>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Bibliotecas para PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1e3c72;
            --secondary-color: #2a5298;
            --accent-color: #4CAF50;
            --warning-color: #FF9800;
            --danger-color: #F44336;
            --light-color: #f8f9fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7ff;
            color: #333;
            line-height: 1.6;
        }
        
        /* ========== LOGIN & REGISTER ========== */
        .auth-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .auth-box {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            width: 100%;
            max-width: 400px;
        }
        
        .auth-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .auth-header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .auth-header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            background: #f0f2f5;
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            color: #666;
            transition: all 0.3s ease;
        }
        
        .auth-tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            background: white;
            font-weight: 600;
        }
        
        .auth-form {
            padding: 30px;
            display: none;
        }
        
        .auth-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .auth-input-group {
            margin-bottom: 20px;
        }
        
        .auth-input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        .auth-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .auth-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .auth-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-top: 10px;
        }
        
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .auth-message {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            display: none;
        }
        
        .auth-message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }
        
        .auth-message.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        .password-container {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 14px;
        }
        
        .auth-loading {
            display: none;
            text-align: center;
            margin: 10px 0;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ========== SISTEMA DE EVALUACI√ìN ========== */
        .main-container {
            display: none;
            background-color: #f5f7ff;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .section {
            padding: 25px;
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            color: var(--primary-color);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary-color);
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        select.form-control {
            background-color: white;
            cursor: pointer;
        }
        
        .question-group {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .score-display {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin: 25px 0;
        }
        
        .score-value {
            font-size: 3.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .risk-level {
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            color: white;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .risk-low { background: linear-gradient(135deg, #4CAF50, #2E7D32); }
        .risk-moderate { background: linear-gradient(135deg, #FF9800, #EF6C00); }
        .risk-high { background: linear-gradient(135deg, #F44336, #C62828); }
        .risk-very-high { background: linear-gradient(135deg, #9C27B0, #6A1B9A); }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #EF6C00);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #F44336, #C62828);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .nav-tabs {
            display: flex;
            background: #f0f2f5;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 15px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .nav-tab:hover {
            background: rgba(255,255,255,0.5);
        }
        
        .nav-tab.active {
            border-bottom-color: var(--primary-color);
            background: white;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .recommendations-grid {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }
        
        .recommendation-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
        }
        
        /* Secci√≥n Compartir */
        .share-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .share-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .share-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .share-icon {
            font-size: 2.8rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .share-card h3 {
            margin: 10px 0;
            color: var(--primary-color);
        }
        
        .share-card p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Notificaciones */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s ease;
            max-width: 350px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #F44336, #C62828);
        }
        
        .notification.info {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }
        
        .notification.warning {
            background: linear-gradient(135deg, #FF9800, #EF6C00);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Grid para formularios */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        /* Secci√≥n Tinetti completa */
        .tinetti-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .tinetti-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .tinetti-section h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.1rem;
            background: rgba(30, 60, 114, 0.1);
            padding: 10px;
            border-radius: 5px;
        }
        
        .tinetti-option {
            margin-bottom: 10px;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tinetti-option:hover {
            border-color: var(--primary-color);
            background: #f0f7ff;
        }
        
        .tinetti-option.selected {
            border-color: var(--accent-color);
            background: #e8f5e9;
            font-weight: 600;
        }
        
        .tinetti-score-box {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        /* Estilos para resultados */
        .resultados-detallados {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .resultado-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .resultado-item:last-child {
            border-bottom: none;
        }
        
        .resultado-label {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .resultado-valor {
            font-weight: 500;
        }
        
        /* Informe profesional */
        .informe-profesional {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .cabecera-informe {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .logo-informe {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .titulo-informe {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .subtitulo-informe {
            color: #666;
            font-size: 1rem;
        }
        
        .seccion-informe {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .seccion-informe h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tabla-informe {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .tabla-informe th {
            background: var(--primary-color);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        .tabla-informe td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tabla-informe tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .firma-informe {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }
        
        /* Firebase espec√≠fico */
        .firebase-status {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1001;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            background-color: #FF9800;
            color: white;
        }
        
        .firebase-connected {
            background-color: #4CAF50;
        }
        
        .firebase-disconnected {
            background-color: #F44336;
        }
        
        .historial-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 4px solid var(--primary-color);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .historial-item:hover {
            background: #e8f4fd;
            transform: translateX(5px);
        }
        
        .historial-item h4 {
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        
        .historial-item p {
            margin: 5px 0;
            font-size: 0.9rem;
            color: #666;
        }
        
        .firebase-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .firebase-actions button {
            padding: 5px 10px;
            font-size: 0.8rem;
            flex: 1;
            min-width: 80px;
        }
        
        .historial-container {
            max-height: 500px;
            overflow-y: auto;
            margin: 20px 0;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* User display */
        .user-display {
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .user-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid white;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: white;
            color: var(--primary-color);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .auth-container {
                padding: 10px;
            }
            
            .auth-box {
                border-radius: 10px;
            }
            
            .auth-form {
                padding: 20px;
            }
            
            body {
                padding: 10px;
            }
            
            .section {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .score-value {
                font-size: 2.8rem;
            }
            
            .btn {
                width: 100%;
                margin: 5px 0;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .share-options {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .informe-profesional {
                padding: 20px;
            }
            
            .firebase-actions {
                flex-direction: column;
            }
            
            .firebase-actions button {
                width: 100%;
            }
            
            .user-display {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        .info-box {
            background: #e8f4fd;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid var(--warning-color);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .error-input {
            border-color: var(--danger-color) !important;
            background-color: #fff5f5;
        }
        
        .error-message {
            color: var(--danger-color);
            font-size: 0.875rem;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Status Firebase -->
    <div id="firebase-status" class="firebase-status">
        <i class="fas fa-sync fa-spin"></i> Conectando...
    </div>
    
    <!-- Notificaci√≥n -->
    <div id="notification" class="notification"></div>
    
    <!-- Sistema de Autenticaci√≥n -->
    <div id="auth-container" class="auth-container">
        <div class="auth-box">
            <div class="auth-header">
                <h1><i class="fas fa-hospital-alt"></i> Sistema IRAT-5</h1>
                <p>Evaluaci√≥n Cl√≠nica Integral - Acceso Seguro</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" id="tab-login">Iniciar Sesi√≥n</button>
                <button class="auth-tab" id="tab-register">Registrarse</button>
            </div>
            
            <!-- Formulario de Login -->
            <form id="login-form" class="auth-form active">
                <div class="auth-input-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" class="auth-input" placeholder="usuario@ejemplo.com" required>
                </div>
                
                <div class="auth-input-group">
                    <label for="login-password">Contrase√±a</label>
                    <div class="password-container">
                        <input type="password" id="login-password" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('login-password')">üëÅÔ∏è</button>
                    </div>
                </div>
                
                <div class="auth-loading" id="login-loading">
                    <div class="spinner"></div>
                </div>
                
                <button type="submit" class="auth-btn">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n
                </button>
                
                <div class="auth-message" id="login-message"></div>
                
                <div style="text-align: center; margin-top: 20px; color: #666; font-size: 0.9rem;">
                    <p>Demo: admin@irat.com / admin123</p>
                </div>
            </form>
            
            <!-- Formulario de Registro -->
            <form id="register-form" class="auth-form">
                <div class="auth-input-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" class="auth-input" placeholder="usuario@ejemplo.com" required>
                </div>
                
                <div class="auth-input-group">
                    <label for="register-password">Contrase√±a</label>
                    <div class="password-container">
                        <input type="password" id="register-password" class="auth-input" placeholder="M√≠nimo 6 caracteres" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('register-password')">üëÅÔ∏è</button>
                    </div>
                </div>
                
                <div class="auth-input-group">
                    <label for="confirm-password">Confirmar Contrase√±a</label>
                    <div class="password-container">
                        <input type="password" id="confirm-password" class="auth-input" placeholder="Repite la contrase√±a" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('confirm-password')">üëÅÔ∏è</button>
                    </div>
                </div>
                
                <div class="auth-input-group">
                    <label for="register-name">Nombre Completo</label>
                    <input type="text" id="register-name" class="auth-input" placeholder="Nombre y apellidos" required>
                </div>
                
                <div class="auth-loading" id="register-loading">
                    <div class="spinner"></div>
                </div>
                
                <button type="submit" class="auth-btn">
                    <i class="fas fa-user-plus"></i> Registrarse
                </button>
                
                <div class="auth-message" id="register-message"></div>
            </form>
        </div>
    </div>
    
    <!-- Sistema de Evaluaci√≥n Cl√≠nica -->
    <div id="main-container" class="main-container">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1><i class="fas fa-hospital-alt"></i> IRAT-5 + Tinetti + Norton</h1>
                <p>Evaluaci√≥n Cl√≠nica Integral de Riesgo - Sistema Profesional</p>
                <div class="user-display">
                    <div class="user-info">
                        <i class="fas fa-user-md"></i> <span id="current-user-email"></span>
                    </div>
                    <button class="logout-btn" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button class="nav-tab active" data-section="identificacion">Identificaci√≥n</button>
                <button class="nav-tab" data-section="evaluacion">IRAT-5</button>
                <button class="nav-tab" data-section="tinetti">Tinetti</button>
                <button class="nav-tab" data-section="norton">Norton</button>
                <button class="nav-tab" data-section="resultados">Resultados</button>
                <button class="nav-tab" data-section="historial">Historial</button>
                <button class="nav-tab" data-section="compartir">Compartir</button>
            </div>
            
            <!-- Secci√≥n 1: Identificaci√≥n -->
            <section id="identificacion" class="section active">
                <h2 class="section-title"><i class="fas fa-user"></i> Identificaci√≥n del Paciente</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Nombre completo <span style="color:red">*</span></label>
                        <input type="text" id="nombre" class="form-control" placeholder="Nombre y apellidos del paciente" required>
                        <div id="error-nombre" class="error-message"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">RUT / Identificaci√≥n</label>
                        <input type="text" id="rut" class="form-control" placeholder="Ej: 12.345.678-9">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Edad</label>
                        <input type="number" id="edad" class="form-control" placeholder="Edad en a√±os">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Fecha evaluaci√≥n <span style="color:red">*</span></label>
                        <input type="date" id="fecha" class="form-control" required>
                        <div id="error-fecha" class="error-message"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Sexo</label>
                        <select id="sexo" class="form-control">
                            <option value="">Seleccione...</option>
                            <option value="masculino">Masculino</option>
                            <option value="femenino">Femenino</option>
                            <option value="no especificado">No especificado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Evaluador <span style="color:red">*</span></label>
                        <input type="text" id="evaluador" class="form-control" placeholder="Nombre del profesional" required>
                        <div id="error-evaluador" class="error-message"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Instituci√≥n/Cl√≠nica</label>
                        <input type="text" id="institucion" class="form-control" placeholder="Nombre de la instituci√≥n">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">N√∫mero de Historia Cl√≠nica</label>
                        <input type="text" id="historia-clinica" class="form-control" placeholder="N√∫mero de identificaci√≥n">
                    </div>
                </div>
                
                <div class="action-buttons">
                    <div></div>
                    <button class="btn btn-primary" id="siguiente-irat">
                        <i class="fas fa-arrow-right"></i> Siguiente: IRAT-5
                    </button>
                </div>
            </section>
            
            <!-- Secci√≥n 2: IRAT-5 -->
            <section id="evaluacion" class="section">
                <h2 class="section-title"><i class="fas fa-clipboard-list"></i> Evaluaci√≥n IRAT-5 Modificado</h2>
                
                <div class="question-group">
                    <div class="question-text">1. Equilibrio Unipodal <span style="color:red">*</span></div>
                    <select id="equilibrio" class="form-control" required>
                        <option value="">Seleccione...</option>
                        <option value="0">‚â• 30 segundos (0 pts)</option>
                        <option value="1">15-29 segundos (1 pts)</option>
                        <option value="2">5-14 segundos (2 pts)</option>
                        <option value="3">< 5 segundos (3 pts)</option>
                        <option value="4">No puede mantenerse (4 pts)</option>
                    </select>
                    <div id="error-equilibrio" class="error-message"></div>
                </div>
                
                <div class="question-group">
                    <div class="question-text">2. Tipo de Amputaci√≥n <span style="color:red">*</span></div>
                    <select id="amputacion" class="form-control" required>
                        <option value="">Seleccione...</option>
                        <option value="0">Sin amputaciones (0 pts)</option>
                        <option value="1">Amputaci√≥n transmetatarsiana (1 pts)</option>
                        <option value="3">Unilateral infracond√≠lea (3 pts + 1 riesgo ca√≠das)</option>
                        <option value="4">Bilateral infracond√≠lea (4 pts + 1 riesgo ca√≠das)</option>
                        <option value="5">Supracond√≠lea unilateral (5 pts + 1 riesgo ca√≠das)</option>
                        <option value="6">Supracond√≠lea bilateral (6 pts + 1 riesgo ca√≠das)</option>
                    </select>
                    <div id="error-amputacion" class="error-message"></div>
                </div>
                
                <div class="warning-box">
                    <strong><i class="fas fa-exclamation-triangle"></i> Consideraciones amputaciones:</strong><br>
                    ‚Ä¢ Bilaterales: Requieren silla de ruedas (NO bast√≥n/andador)<br>
                    ‚Ä¢ Unilaterales: Iniciar con andador articulado/fijo (sin ruedas)
                </div>
                
                <div class="question-group">
                    <div class="question-text">3. Funci√≥n de Brazos <span style="color:red">*</span></div>
                    <select id="brazos" class="form-control" required>
                        <option value="">Seleccione...</option>
                        <option value="0">Ambos brazos normales o fuerza ‚â•3 (0 pts)</option>
                        <option value="1">Problemas en un brazo/fuerza <3 (1 pts)</option>
                        <option value="2">Problemas en ambos brazos (2 pts)</option>
                    </select>
                    <div id="error-brazos" class="error-message"></div>
                </div>
                
                <div class="question-group">
                    <div class="question-text">4. Situaci√≥n Social <span style="color:red">*</span></div>
                    <select id="social" class="form-control" required>
                        <option value="">Seleccione...</option>
                        <option value="0">Cuidador profesional (0 pts)</option>
                        <option value="1">Cuidador informal (1 pts)</option>
                        <option value="2">Vive solo o sin cuidador (2 pts)</option>
                        <option value="3">Es cuidador de persona fr√°gil (3 pts)</option>
                    </select>
                    <div id="error-social" class="error-message"></div>
                </div>
                
                <div class="question-group">
                    <div class="question-text">5. Nivel de Cooperaci√≥n <span style="color:red">*</span></div>
                    <select id="cooperacion" class="form-control" required>
                        <option value="">Seleccione...</option>
                        <option value="0">Excelente - Sigue todas las instrucciones (0 pts)</option>
                        <option value="1">Buena - Sigue mayor√≠a de instrucciones (1 pts)</option>
                        <option value="2">Moderada - Requiere motivaci√≥n constante (2 pts)</option>
                        <option value="3">Mala - Se resiste o rechaza instrucciones (3 pts)</option>
                    </select>
                    <div id="error-cooperacion" class="error-message"></div>
                </div>
                
                <div class="score-display">
                    <div>Puntaje IRAT-5 (preliminar)</div>
                    <div class="score-value" id="puntaje-irat">0</div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-warning" id="volver-identificacion">
                        <i class="fas fa-arrow-left"></i> Anterior
                    </button>
                    <button class="btn btn-primary" id="siguiente-tinetti">
                        Siguiente: Tinetti <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </section>
            
            <!-- Secci√≥n 3: Tinetti COMPLETO -->
            <section id="tinetti" class="section">
                <h2 class="section-title"><i class="fas fa-walking"></i> Test de Tinetti Completo</h2>
                
                <div class="info-box">
                    <strong>Conversi√≥n a puntos IRAT-5:</strong><br>
                    ‚Ä¢ Tinetti ‚â• 25 puntos = 0 puntos IRAT-5<br>
                    ‚Ä¢ Tinetti 19-24 puntos = 2 puntos IRAT-5<br>
                    ‚Ä¢ Tinetti ‚â§ 18 puntos = 4 puntos IRAT-5<br>
                    ‚Ä¢ No evaluable = 4 puntos IRAT-5 (m√°ximo riesgo)
                </div>
                
                <div class="tinetti-container">
                    <!-- Opci√≥n No Evaluable -->
                    <div class="question-group">
                        <div class="question-text">¬øEs evaluable el Test de Tinetti? <span style="color:red">*</span></div>
                        <div id="opcion-no-evaluable" class="tinetti-option" data-puntaje="0" data-irat="4">
                            <strong>NO EVALUABLE</strong><br>
                            <small>Paciente no puede realizar la prueba (m√°ximo riesgo - 4 puntos IRAT-5)</small>
                        </div>
                        <div id="error-tinetti-evaluable" class="error-message"></div>
                    </div>
                    
                    <!-- Si es evaluable, mostrar el test completo -->
                    <div id="test-tinetti-completo">
                        <!-- ... (contenido del test Tinetti igual que antes) ... -->
                    </div>
                    
                    <!-- Resultados Tinetti -->
                    <div id="resultado-tinetti" style="display: none;">
                        <div class="tinetti-score-box">
                            <h4>Resultado Test de Tinetti</h4>
                            <div class="score-value" id="puntaje-tinetti-total">0</div>
                            <div>/28 puntos</div>
                            <div id="interpretacion-tinetti"></div>
                            <div id="puntos-irat-tinetti"></div>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-warning" id="volver-irat">
                        <i class="fas fa-arrow-left"></i> Anterior
                    </button>
                    <button class="btn btn-primary" id="siguiente-norton">
                        Siguiente: Norton <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </section>
            
            <!-- Secci√≥n 4: Escala Norton -->
            <section id="norton" class="section">
                <h2 class="section-title"><i class="fas fa-bed"></i> Escala Norton</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Estado F√≠sico</label>
                        <select id="norton-fisico" class="form-control">
                            <option value="4">Bueno (4 pts)</option>
                            <option value="3" selected>Regular (3 pts)</option>
                            <option value="2">Malo (2 pts)</option>
                            <option value="1">Muy malo (1 pts)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Estado Mental</label>
                        <select id="norton-mental" class="form-control">
                            <option value="4">Alerta (4 pts)</option>
                            <option value="3" selected>Apat√≠a (3 pts)</option>
                            <option value="2">Confuso (2 pts)</option>
                            <option value="1">Estupor (1 pts)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Actividad</label>
                        <select id="norton-actividad" class="form-control">
                            <option value="4">Deambula (4 pts)</option>
                            <option value="3" selected>Deambula con ayuda (3 pts)</option>
                            <option value="2">Sill√≥n (2 pts)</option>
                            <option value="1">Encamado (1 pts)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Movilidad</label>
                        <select id="norton-movilidad" class="form-control">
                            <option value="4">Completa (4 pts)</option>
                            <option value="3" selected>Ligeramente limitada (3 pts)</option>
                            <option value="2">Muy limitada (2 pts)</option>
                            <option value="1">Inm√≥vil (1 pts)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Incontinencia</label>
                        <select id="norton-incontinencia" class="form-control">
                            <option value="4">Ninguna (4 pts)</option>
                            <option value="3" selected>Ocasional (3 pts)</option>
                            <option value="2">Urinaria (2 pts)</option>
                            <option value="1">Urinaria y fecal (1 pts)</option>
                        </select>
                    </div>
                </div>
                
                <div class="score-display">
                    <div>Puntaje Total Norton</div>
                    <div class="score-value" id="puntaje-norton">15</div>
                    <div>Interpretaci√≥n: 20-16 (Bajo riesgo) | 15-12 (Riesgo) | ‚â§11 (Alto riesgo)</div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-warning" id="volver-tinetti">
                        <i class="fas fa-arrow-left"></i> Anterior
                    </button>
                    <button class="btn btn-success" id="calcular-resultados">
                        <i class="fas fa-calculator"></i> Calcular Resultados
                    </button>
                </div>
            </section>
            
            <!-- Secci√≥n 5: Resultados -->
            <section id="resultados" class="section">
                <h2 class="section-title"><i class="fas fa-chart-line"></i> Resultados Integrales</h2>
                
                <div id="contenido-resultados">
                    <p style="text-align: center; color: #666; padding: 40px;">
                        Complete todas las secciones anteriores y haga clic en "Calcular Resultados"
                    </p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-warning" id="volver-norton">
                        <i class="fas fa-arrow-left"></i> Anterior
                    </button>
                    <button class="btn btn-primary" id="ir-compartir">
                        Compartir Resultados <i class="fas fa-share-alt"></i>
                    </button>
                </div>
            </section>
            
            <!-- Secci√≥n 6: Historial -->
            <section id="historial" class="section">
                <h2 class="section-title"><i class="fas fa-history"></i> Historial de Evaluaciones</h2>
                
                <div class="info-box">
                    <strong><i class="fas fa-database"></i> Historial en la nube (Firebase)</strong>
                    <p>Las evaluaciones se guardan de forma segura en la base de datos en la nube.</p>
                    <div id="firebase-stats" style="margin-top: 10px;">
                        <span id="total-evaluaciones">Cargando estad√≠sticas...</span>
                    </div>
                </div>
                
                <!-- Filtros de b√∫squeda -->
                <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4 style="margin-bottom: 15px; color: var(--primary-color);">
                        <i class="fas fa-filter"></i> Filtros de b√∫squeda
                    </h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Nombre del paciente</label>
                            <input type="text" id="filter-nombre" class="form-control" placeholder="Buscar por nombre">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fecha desde</label>
                            <input type="date" id="filter-fecha-desde" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fecha hasta</label>
                            <input type="date" id="filter-fecha-hasta" class="form-control">
                        </div>
                    </div>
                    <div class="action-buttons" style="margin-top: 15px;">
                        <button class="btn btn-primary" id="btn-aplicar-filtros">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                        <button class="btn btn-warning" id="btn-limpiar-filtros">
                            <i class="fas fa-undo"></i> Limpiar
                        </button>
                    </div>
                </div>
                
                <!-- Contenedor del historial -->
                <div id="historial-container" class="historial-container">
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-spinner fa-spin fa-2x" style="margin-bottom: 20px;"></i>
                        <p>Cargando historial desde Firebase...</p>
                    </div>
                </div>
                
                <!-- Paginaci√≥n -->
                <div id="pagination-container" style="display: none; margin-top: 20px;">
                    <div class="pagination">
                        <button class="btn btn-primary" id="btn-prev" disabled>
                            <i class="fas fa-chevron-left"></i> Anterior
                        </button>
                        <span id="page-info" style="margin: 0 15px;">P√°gina 1</span>
                        <button class="btn btn-primary" id="btn-next">
                            Siguiente <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-warning" id="volver-resultados-historial">
                        <i class="fas fa-arrow-left"></i> Anterior
                    </button>
                    <button class="btn btn-success" id="btn-guardar-firebase">
                        <i class="fas fa-cloud-upload-alt"></i> Guardar actual en la nube
                    </button>
                </div>
            </section>
            
            <!-- Secci√≥n 7: Compartir -->
            <section id="compartir" class="section">
                <h2 class="section-title"><i class="fas fa-share-alt"></i> Compartir Resultados</h2>
                
                <div class="info-box">
                    <strong><i class="fas fa-info-circle"></i> Informe Profesional Detallado</strong>
                    <p>Genere un informe completo con todos los datos de la evaluaci√≥n, resultados detallados y recomendaciones personalizadas.</p>
                </div>
                
                <div class="share-options">
                    <div class="share-card" id="generar-pdf">
                        <div class="share-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <h3>Generar PDF Profesional</h3>
                        <p>Informe detallado con todos los resultados</p>
                    </div>
                    
                    <div class="share-card" id="compartir-whatsapp">
                        <div class="share-icon">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <h3>Compartir por WhatsApp</h3>
                        <p>Resumen profesional para equipo m√©dico</p>
                    </div>
                    
                    <div class="share-card" id="copiar-texto">
                        <div class="share-icon">
                            <i class="fas fa-copy"></i>
                        </div>
                        <h3>Copiar Informe</h3>
                        <p>Copiar informe completo al portapapeles</p>
                    </div>
                    
                    <div class="share-card" id="nueva-evaluacion">
                        <div class="share-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <h3>Nueva Evaluaci√≥n</h3>
                        <p>Empezar evaluaci√≥n nueva</p>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-warning" id="volver-compartir">
                        <i class="fas fa-arrow-left"></i> Anterior
                    </button>
                </div>
            </section>
        </div>
    </div>

    <script>

            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDJbtRuEwWVAsC1Nz6LbeF5a99LcUfAz4g",
  authDomain: "irat-5-evaluaciones.firebaseapp.com",
  databaseURL: "https://irat-5-evaluaciones-default-rtdb.firebaseio.com",
  projectId: "irat-5-evaluaciones",
  storageBucket: "irat-5-evaluaciones.firebasestorage.app",
  messagingSenderId: "487279274410",
  appId: "1:487279274410:web:146e9c35a0bf795c5423d3",
  measurementId: "G-WSXJY5QHJS"
};
        };

        // ========== VARIABLES GLOBALES ==========
        let firebaseApp;
        let db;
        let auth;
        let currentUser = null;
        let datosCompletos = null;
        let historialFirebase = [];
        let currentPage = 1;
        const itemsPerPage = 5;
        let lastVisible = null;
        let firstVisible = null;
        let currentQuery = null;
        
        // Variables del formulario
        let puntajeTotalIRAT = 0;
        let puntajeNorton = 15;
        let puntajeTinetti = 0;
        let nivelRiesgoIRAT = "";
        let nivelRiesgoNorton = "";
        let recomendaciones = [];
        let tinettiNoEvaluable = false;
        let respuestasTinetti = {};
        let respuestasIRAT = {};
        let respuestasNorton = {};

        // ========== INICIALIZACI√ìN ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar Firebase
            inicializarFirebase();
            
            // Configurar autenticaci√≥n
            configurarAutenticacion();
            
            // Configurar navegaci√≥n
            inicializarNavegacion();
            
            // Configurar componentes del formulario
            configurarTinetti();
            configurarIRAT5();
            configurarCompartir();
            configurarHistorial();
            configurarValidaciones();
            
            // Configurar eventos de Norton
            ['norton-fisico', 'norton-mental', 'norton-actividad', 'norton-movilidad', 'norton-incontinencia'].forEach(id => {
                document.getElementById(id).addEventListener('change', calcularNorton);
            });
            
            calcularNorton();
        });

        // ========== INICIALIZAR FIREBASE ==========
        function inicializarFirebase() {
            try {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                
                // Configurar persistencia de sesi√≥n
                auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
                
                // Escuchar cambios de autenticaci√≥n
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        // Usuario autenticado
                        currentUser = user;
                        mostrarSistemaEvaluacion(user);
                        actualizarEstadoFirebase('Conectado', 'firebase-connected');
                        
                        // Cargar historial si estamos en esa secci√≥n
                        if (document.getElementById('historial') && document.getElementById('historial').classList.contains('active')) {
                            cargarHistorialFirebase();
                        }
                        
                        mostrarNotificacion(`Bienvenido ${user.email}`, 'success');
                    } else {
                        // No autenticado
                        currentUser = null;
                        mostrarAutenticacion();
                    }
                });
                
            } catch (error) {
                console.error('Error inicializando Firebase:', error);
                actualizarEstadoFirebase('Error de conexi√≥n', 'firebase-disconnected');
                mostrarNotificacion('Error conectando a Firebase', 'error');
            }
        }

        // ========== SISTEMA DE AUTENTICACI√ìN ==========
        function configurarAutenticacion() {
            // Tabs de login/registro
            document.getElementById('tab-login').addEventListener('click', () => {
                mostrarFormulario('login');
            });
            
            document.getElementById('tab-register').addEventListener('click', () => {
                mostrarFormulario('register');
            });
            
            // Formulario de login
            document.getElementById('login-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('login-email').value.trim();
                const password = document.getElementById('login-password').value;
                
                if (!email || !password) {
                    mostrarMensajeAuth('login', 'Ingrese email y contrase√±a', 'error');
                    return;
                }
                
                mostrarLoading('login', true);
                
                try {
                    const userCredential = await auth.signInWithEmailAndPassword(email, password);
                    mostrarMensajeAuth('login', 'Inicio de sesi√≥n exitoso', 'success');
                    
                    // El cambio de estado se manejar√° en onAuthStateChanged
                    
                } catch (error) {
                    console.error('Error de login:', error);
                    let mensaje = 'Error de autenticaci√≥n';
                    
                    switch(error.code) {
                        case 'auth/user-not-found':
                            mensaje = 'Usuario no encontrado';
                            break;
                        case 'auth/wrong-password':
                            mensaje = 'Contrase√±a incorrecta';
                            break;
                        case 'auth/invalid-email':
                            mensaje = 'Email inv√°lido';
                            break;
                        case 'auth/too-many-requests':
                            mensaje = 'Demasiados intentos. Intente m√°s tarde';
                            break;
                    }
                    
                    mostrarMensajeAuth('login', mensaje, 'error');
                } finally {
                    mostrarLoading('login', false);
                }
            });
            
            // Formulario de registro
            document.getElementById('register-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('register-email').value.trim();
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                const name = document.getElementById('register-name').value.trim();
                
                if (!email || !password || !confirmPassword || !name) {
                    mostrarMensajeAuth('register', 'Complete todos los campos', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    mostrarMensajeAuth('register', 'Las contrase√±as no coinciden', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    mostrarMensajeAuth('register', 'La contrase√±a debe tener al menos 6 caracteres', 'error');
                    return;
                }
                
                mostrarLoading('register', true);
                
                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    
                    // Guardar informaci√≥n adicional del usuario en Firestore
                    await db.collection('usuarios').doc(userCredential.user.uid).set({
                        email: email,
                        nombre: name,
                        fechaRegistro: firebase.firestore.FieldValue.serverTimestamp(),
                        role: 'usuario'
                    });
                    
                    mostrarMensajeAuth('register', '¬°Cuenta creada exitosamente!', 'success');
                    
                    // Cambiar autom√°ticamente a login despu√©s de 2 segundos
                    setTimeout(() => {
                        mostrarFormulario('login');
                        document.getElementById('login-email').value = email;
                        document.getElementById('login-password').value = '';
                    }, 2000);
                    
                } catch (error) {
                    console.error('Error de registro:', error);
                    let mensaje = 'Error al crear la cuenta';
                    
                    switch(error.code) {
                        case 'auth/email-already-in-use':
                            mensaje = 'El email ya est√° registrado';
                            break;
                        case 'auth/invalid-email':
                            mensaje = 'Email inv√°lido';
                            break;
                        case 'auth/weak-password':
                            mensaje = 'La contrase√±a es muy d√©bil';
                            break;
                    }
                    
                    mostrarMensajeAuth('register', mensaje, 'error');
                } finally {
                    mostrarLoading('register', false);
                }
            });
            
            // Bot√≥n de logout
            document.getElementById('logout-btn').addEventListener('click', function() {
                if (confirm('¬øEst√° seguro de cerrar sesi√≥n?')) {
                    auth.signOut().then(() => {
                        mostrarNotificacion('Sesi√≥n cerrada exitosamente', 'info');
                    }).catch((error) => {
                        console.error('Error cerrando sesi√≥n:', error);
                        mostrarNotificacion('Error al cerrar sesi√≥n', 'error');
                    });
                }
            });
        }
        
        function mostrarFormulario(tipo) {
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            
            if (tipo === 'login') {
                document.getElementById('tab-login').classList.add('active');
                document.getElementById('login-form').classList.add('active');
            } else {
                document.getElementById('tab-register').classList.add('active');
                document.getElementById('register-form').classList.add('active');
            }
            
            // Limpiar mensajes
            document.getElementById('login-message').className = 'auth-message';
            document.getElementById('register-message').className = 'auth-message';
        }
        
        function mostrarMensajeAuth(tipo, mensaje, clase) {
            const messageDiv = document.getElementById(`${tipo}-message`);
            messageDiv.textContent = mensaje;
            messageDiv.className = `auth-message ${clase}`;
            
            if (clase === 'success') {
                setTimeout(() => {
                    messageDiv.className = 'auth-message';
                }, 3000);
            }
        }
        
        function mostrarLoading(tipo, mostrar) {
            document.getElementById(`${tipo}-loading`).style.display = mostrar ? 'block' : 'none';
        }
        
        function mostrarAutenticacion() {
            document.getElementById('auth-container').style.display = 'flex';
            document.getElementById('main-container').style.display = 'none';
        }
        
        function mostrarSistemaEvaluacion(user) {
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('main-container').style.display = 'block';
            document.getElementById('current-user-email').textContent = user.email;
            
            // Configurar fecha actual en el formulario
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('fecha')) {
                document.getElementById('fecha').value = today;
            }
        }

        // ========== FUNCIONALIDADES DEL SISTEMA DE EVALUACI√ìN ==========
        // (Aqu√≠ va todo el c√≥digo del sistema de evaluaci√≥n que ya ten√≠as)
        // Incluyendo todas las funciones de: configurarTinetti, configurarIRAT5,
        // calcularResultadosCompletos, mostrarResultados, etc.
        
        // Para mantener la longitud del c√≥digo, he omitido estas funciones ya que
        // son id√©nticas a las que ya ten√≠as en tu c√≥digo original.
        // Solo necesitas copiar y pegar las funciones desde tu c√≥digo anterior
        // que comienzan despu√©s de la l√≠nea: "// ========== FUNCIONES DEL FORMULARIO =========="
// ========== FUNCIONES DEL FORMULARIO ==========
function inicializarNavegacion() {
    // Navegaci√≥n por pesta√±as
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const sectionId = this.getAttribute('data-section');
            
            // Si es historial y no est√° autenticado, mostrar login
            if (sectionId === 'historial' && !currentUser) {
                mostrarLogin();
                mostrarNotificacion('Debe iniciar sesi√≥n para ver el historial', 'warning');
                return;
            }
            
            cambiarSeccion(sectionId);
            
            // Cargar historial si es la secci√≥n correspondiente
            if (sectionId === 'historial' && currentUser) {
                cargarHistorialFirebase();
            }
        });
    });
    
    // Botones de navegaci√≥n del formulario
    document.getElementById('siguiente-irat').addEventListener('click', () => {
        if (validarSeccionIdentificacion()) cambiarSeccion('evaluacion');
    });
    document.getElementById('volver-identificacion').addEventListener('click', () => cambiarSeccion('identificacion'));
    document.getElementById('siguiente-tinetti').addEventListener('click', () => {
        if (validarSeccionIRAT5()) cambiarSeccion('tinetti');
    });
    document.getElementById('volver-irat').addEventListener('click', () => cambiarSeccion('evaluacion'));
    document.getElementById('siguiente-norton').addEventListener('click', () => {
        if (validarSeccionTinetti()) cambiarSeccion('norton');
    });
    document.getElementById('volver-tinetti').addEventListener('click', () => cambiarSeccion('tinetti'));
    document.getElementById('calcular-resultados').addEventListener('click', calcularResultadosCompletos);
    document.getElementById('volver-norton').addEventListener('click', () => cambiarSeccion('norton'));
    document.getElementById('ir-compartir').addEventListener('click', () => {
        if (datosCompletos) cambiarSeccion('compartir');
        else mostrarNotificacion('Primero calcule los resultados', 'error');
    });
    document.getElementById('volver-resultados-historial').addEventListener('click', () => cambiarSeccion('resultados'));
    document.getElementById('volver-compartir').addEventListener('click', () => cambiarSeccion('resultados'));
    document.getElementById('nueva-evaluacion').addEventListener('click', iniciarNuevaEvaluacion);
}

function cambiarSeccion(sectionId) {
    document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
    });
    
    const seccion = document.getElementById(sectionId);
    if (seccion) seccion.classList.add('active');
    
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.getAttribute('data-section') === sectionId) {
            tab.classList.add('active');
        }
    });
    
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function configurarValidaciones() {
    const camposRequeridos = document.querySelectorAll('[required]');
    camposRequeridos.forEach(campo => {
        campo.addEventListener('blur', function() {
            if (!this.value.trim()) {
                this.classList.add('error-input');
                mostrarErrorCampo(this.id, 'Este campo es requerido');
            } else {
                this.classList.remove('error-input');
                eliminarErrorCampo(this.id);
            }
        });
    });
}

function mostrarErrorCampo(idCampo, mensaje) {
    const errorDiv = document.getElementById(`error-${idCampo}`);
    if (errorDiv) {
        errorDiv.textContent = mensaje;
        errorDiv.style.display = 'block';
    }
}

function eliminarErrorCampo(idCampo) {
    const errorDiv = document.getElementById(`error-${idCampo}`);
    if (errorDiv) errorDiv.style.display = 'none';
}

function validarSeccionIdentificacion() {
    let valido = true;
    ['nombre', 'fecha', 'evaluador'].forEach(campo => {
        const elemento = document.getElementById(campo);
        if (!elemento.value.trim()) {
            elemento.classList.add('error-input');
            mostrarErrorCampo(campo, 'Este campo es requerido');
            valido = false;
        } else {
            elemento.classList.remove('error-input');
            eliminarErrorCampo(campo);
        }
    });
    if (!valido) mostrarNotificacion('Complete todos los campos requeridos', 'error');
    return valido;
}

function validarSeccionIRAT5() {
    let valido = true;
    ['equilibrio', 'amputacion', 'brazos', 'social', 'cooperacion'].forEach(id => {
        const select = document.getElementById(id);
        if (!select.value) {
            select.classList.add('error-input');
            mostrarErrorCampo(id, 'Seleccione una opci√≥n');
            valido = false;
        } else {
            select.classList.remove('error-input');
            eliminarErrorCampo(id);
        }
    });
    if (!valido) mostrarNotificacion('Complete todas las preguntas IRAT-5', 'error');
    return valido;
}

function validarSeccionTinetti() {
    if (tinettiNoEvaluable) return true;
    for (let i = 1; i <= 16; i++) {
        const grupo = i <= 8 ? `balance${i}` : `gait${i}`;
        if (!respuestasTinetti[grupo]) {
            mostrarNotificacion('Complete todas las preguntas del Test de Tinetti', 'error');
            return false;
        }
    }
    return true;
}

function configurarTinetti() {
    document.getElementById('opcion-no-evaluable').addEventListener('click', function() {
        tinettiNoEvaluable = true;
        document.getElementById('test-tinetti-completo').style.display = 'none';
        document.querySelectorAll('.tinetti-option[data-grupo]').forEach(opt => opt.classList.remove('selected'));
        this.classList.add('selected');
        mostrarResultadoTinetti();
    });
    
    document.querySelectorAll('.tinetti-option[data-grupo]').forEach(option => {
        option.addEventListener('click', function() {
            tinettiNoEvaluable = false;
            document.getElementById('test-tinetti-completo').style.display = 'block';
            document.getElementById('opcion-no-evaluable').classList.remove('selected');
            
            const grupo = this.getAttribute('data-grupo');
            document.querySelectorAll(`.tinetti-option[data-grupo="${grupo}"]`).forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            
            respuestasTinetti[grupo] = {
                numero: parseInt(grupo.replace(/[a-z]/g, '')),
                pregunta: obtenerTextoPreguntaTinetti(grupo),
                respuesta: this.querySelector('strong')?.textContent || this.textContent,
                puntos: parseInt(this.getAttribute('data-puntaje'))
            };
            
            calcularPuntajeTinetti();
        });
    });
}

function calcularPuntajeTinetti() {
    if (tinettiNoEvaluable) {
        puntajeTinetti = 0;
        mostrarResultadoTinetti();
        return;
    }
    
    puntajeTinetti = 0;
    for (let i = 1; i <= 16; i++) {
        const grupo = i <= 8 ? `balance${i}` : `gait${i}`;
        if (respuestasTinetti[grupo]) {
            puntajeTinetti += respuestasTinetti[grupo].puntos || 0;
        }
    }
    mostrarResultadoTinetti();
}

function mostrarResultadoTinetti() {
    const resultadoDiv = document.getElementById('resultado-tinetti');
    if (!resultadoDiv) return;
    
    if (tinettiNoEvaluable) {
        resultadoDiv.style.display = 'block';
        document.getElementById('puntaje-tinetti-total').textContent = 'No evaluable';
        document.getElementById('interpretacion-tinetti').innerHTML = '<strong>M√°ximo riesgo de ca√≠das</strong>';
        document.getElementById('puntos-irat-tinetti').innerHTML =
        // ========== FUNCIONES AUXILIARES ==========
        function actualizarEstadoFirebase(mensaje, clase) {
            const statusElement = document.getElementById('firebase-status');
            statusElement.textContent = mensaje;
            statusElement.className = `firebase-status ${clase}`;
        }
        
        function mostrarNotificacion(mensaje, tipo) {
            const notificacion = document.getElementById('notification');
            notificacion.textContent = mensaje;
            notificacion.className = `notification ${tipo}`;
            notificacion.style.display = 'block';
            
            setTimeout(() => {
                notificacion.style.display = 'none';
            }, 4000);
        }
        
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }
        
        // ========== DEMO AUTO-LOGIN ==========
        // Para facilitar las pruebas, puedes descomentar esto
        // window.addEventListener('load', function() {
        //     setTimeout(() => {
        //         document.getElementById('login-email').value = 'admin@irat.com';
        //         document.getElementById('login-password').value = 'admin123';
        //         document.getElementById('login-form').dispatchEvent(new Event('submit'));
        //     }, 1000);
        // });
    </script>
</body>
</html>
