<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación Clínica IRAT-5 Modificado + Tinetti + Norton</title>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Bibliotecas para PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1e3c72;
            --secondary-color: #2a5298;
            --accent-color: #4CAF50;
            --warning-color: #FF9800;
            --danger-color: #F44336;
            --light-color: #f8f9fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7ff;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .section {
            padding: 25px;
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .section-title {
            color: var(--primary-color);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary-color);
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        select.form-control {
            background-color: white;
            cursor: pointer;
        }
        
        .question-group {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .score-display {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            margin: 25px 0;
        }
        
        .score-value {
            font-size: 3.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #EF6C00);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #F44336, #C62828);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .nav-tabs {
            display: flex;
            background: #f0f2f5;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 15px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .nav-tab:hover {
            background: rgba(255,255,255,0.5);
        }
        
        .nav-tab.active {
            border-bottom-color: var(--primary-color);
            background: white;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .error-input {
            border-color: var(--danger-color) !important;
            background-color: #fff5f5;
        }
        
        .error-message {
            color: var(--danger-color);
            font-size: 0.875rem;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-hospital-alt"></i> IRAT-5 + Tinetti + Norton</h1>
            <p>Evaluación Clínica Integral de Riesgo - Sistema Profesional</p>
        </div>
        
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-section="identificacion">Identificación</button>
            <button class="nav-tab" data-section="evaluacion">IRAT-5</button>
            <button class="nav-tab" data-section="tinetti">Tinetti</button>
            <button class="nav-tab" data-section="norton">Norton</button>
            <button class="nav-tab" data-section="resultados">Resultados</button>
        </div>
        
        <!-- Sección 1: Identificación -->
        <section id="identificacion" class="section active">
            <h2 class="section-title"><i class="fas fa-user"></i> Identificación del Paciente</h2>
            
            <div class="form-group">
                <label class="form-label">Nombre completo <span style="color:red">*</span></label>
                <input type="text" id="nombre" class="form-control" placeholder="Nombre y apellidos del paciente" required>
                <div id="error-nombre" class="error-message"></div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Fecha evaluación <span style="color:red">*</span></label>
                <input type="date" id="fecha" class="form-control" required>
                <div id="error-fecha" class="error-message"></div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Evaluador <span style="color:red">*</span></label>
                <input type="text" id="evaluador" class="form-control" placeholder="Nombre del profesional" required>
                <div id="error-evaluador" class="error-message"></div>
            </div>
            
            <div class="action-buttons">
                <div></div>
                <button class="btn btn-primary" id="siguiente-irat">
                    <i class="fas fa-arrow-right"></i> Siguiente: IRAT-5
                </button>
            </div>
        </section>
        
        <!-- Sección 2: IRAT-5 -->
        <section id="evaluacion" class="section">
            <h2 class="section-title"><i class="fas fa-clipboard-list"></i> Evaluación IRAT-5 Modificado</h2>
            
            <div class="question-group">
                <div class="question-text">1. Equilibrio Unipodal <span style="color:red">*</span></div>
                <select id="equilibrio" class="form-control" required>
                    <option value="">Seleccione...</option>
                    <option value="0">≥ 30 segundos (0 pts)</option>
                    <option value="1">15-29 segundos (1 pts)</option>
                    <option value="2">5-14 segundos (2 pts)</option>
                    <option value="3">< 5 segundos (3 pts)</option>
                    <option value="4">No puede mantenerse (4 pts)</option>
                </select>
                <div id="error-equilibrio" class="error-message"></div>
            </div>
            
            <div class="question-group">
                <div class="question-text">2. Tipo de Amputación <span style="color:red">*</span></div>
                <select id="amputacion" class="form-control" required>
                    <option value="">Seleccione...</option>
                    <option value="0">Sin amputaciones (0 pts)</option>
                    <option value="1">Amputación transmetatarsiana (1 pts)</option>
                    <option value="3">Unilateral infracondílea (3 pts + 1 riesgo caídas)</option>
                    <option value="4">Bilateral infracondílea (4 pts + 1 riesgo caídas)</option>
                    <option value="5">Supracondílea unilateral (5 pts + 1 riesgo caídas)</option>
                    <option value="6">Supracondílea bilateral (6 pts + 1 riesgo caídas)</option>
                </select>
                <div id="error-amputacion" class="error-message"></div>
            </div>
            
            <div class="question-group">
                <div class="question-text">3. Función de Brazos <span style="color:red">*</span></div>
                <select id="brazos" class="form-control" required>
                    <option value="">Seleccione...</option>
                    <option value="0">Ambos brazos normales o fuerza ≥3 (0 pts)</option>
                    <option value="1">Problemas en un brazo/fuerza <3 (1 pts)</option>
                    <option value="2">Problemas en ambos brazos (2 pts)</option>
                </select>
                <div id="error-brazos" class="error-message"></div>
            </div>
            
            <div class="question-group">
                <div class="question-text">4. Situación Social <span style="color:red">*</span></div>
                <select id="social" class="form-control" required>
                    <option value="">Seleccione...</option>
                    <option value="0">Cuidador profesional (0 pts)</option>
                    <option value="1">Cuidador informal (1 pts)</option>
                    <option value="2">Vive solo o sin cuidador (2 pts)</option>
                    <option value="3">Es cuidador de persona frágil (3 pts)</option>
                </select>
                <div id="error-social" class="error-message"></div>
            </div>
            
            <div class="question-group">
                <div class="question-text">5. Nivel de Cooperación <span style="color:red">*</span></div>
                <select id="cooperacion" class="form-control" required>
                    <option value="">Seleccione...</option>
                    <option value="0">Excelente - Sigue todas las instrucciones (0 pts)</option>
                    <option value="1">Buena - Sigue mayoría de instrucciones (1 pts)</option>
                    <option value="2">Moderada - Requiere motivación constante (2 pts)</option>
                    <option value="3">Mala - Se resiste o rechaza instrucciones (3 pts)</option>
                </select>
                <div id="error-cooperacion" class="error-message"></div>
            </div>
            
            <div class="score-display">
                <div>Puntaje IRAT-5 (preliminar)</div>
                <div class="score-value" id="puntaje-irat">0</div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-warning" id="volver-identificacion">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button class="btn btn-primary" id="siguiente-tinetti">
                    Siguiente: Tinetti <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </section>
        
        <!-- Sección 3: Tinetti -->
        <section id="tinetti" class="section">
            <h2 class="section-title"><i class="fas fa-walking"></i> Test de Tinetti</h2>
            
            <div class="question-group">
                <div class="question-text">¿Es evaluable el Test de Tinetti? <span style="color:red">*</span></div>
                <select id="tinetti-evaluable" class="form-control" required>
                    <option value="">Seleccione...</option>
                    <option value="evaluable">Sí, es evaluable</option>
                    <option value="no-evaluable">No, no es evaluable</option>
                </select>
                <div id="error-tinetti-evaluable" class="error-message"></div>
            </div>
            
            <div id="tinetti-preguntas" style="display: none;">
                <div class="question-group">
                    <div class="question-text">Puntaje Tinetti (0-28)</div>
                    <input type="number" id="puntaje-tinetti" class="form-control" min="0" max="28" placeholder="Ingrese puntaje 0-28">
                    <div id="error-puntaje-tinetti" class="error-message"></div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-warning" id="volver-irat">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button class="btn btn-primary" id="siguiente-norton">
                    Siguiente: Norton <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </section>
        
        <!-- Sección 4: Escala Norton -->
        <section id="norton" class="section">
            <h2 class="section-title"><i class="fas fa-bed"></i> Escala Norton</h2>
            
            <div class="question-group">
                <div class="question-text">Puntaje Norton (5-20)</div>
                <input type="number" id="puntaje-norton" class="form-control" min="5" max="20" placeholder="Ingrese puntaje 5-20" value="15">
                <div id="error-puntaje-norton" class="error-message"></div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-warning" id="volver-tinetti">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button class="btn btn-success" id="calcular-resultados">
                    <i class="fas fa-calculator"></i> Calcular Resultados
                </button>
            </div>
        </section>
        
        <!-- Sección 5: Resultados -->
        <section id="resultados" class="section">
            <h2 class="section-title"><i class="fas fa-chart-line"></i> Resultados Integrales</h2>
            
            <div id="contenido-resultados">
                <p style="text-align: center; color: #666; padding: 40px;">
                    Complete todas las secciones anteriores y haga clic en "Calcular Resultados"
                </p>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-warning" id="volver-norton">
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <button class="btn btn-primary" id="nueva-evaluacion">
                    <i class="fas fa-plus-circle"></i> Nueva Evaluación
                </button>
            </div>
        </section>
    </div>

    <script>
        // ========== VARIABLES GLOBALES ==========
        let datosCompletos = null;
        let puntajeTotalIRAT = 0;
        let puntajeNorton = 15;
        let puntajeTinetti = 0;
        let nivelRiesgoIRAT = "";
        let nivelRiesgoNorton = "";
        let recomendaciones = [];
        let tinettiNoEvaluable = false;

        // ========== INICIALIZACIÓN ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM cargado');
            
            // Configurar fecha actual
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').value = today;
            
            // Configurar navegación
            inicializarNavegacion();
            
            // Configurar eventos
            configurarEventos();
            
            alert('Sistema cargado correctamente. Puede comenzar la evaluación.');
        });

        // ========== CONFIGURAR NAVEGACIÓN ==========
        function inicializarNavegacion() {
            console.log('Inicializando navegación...');
            
            // Navegación por pestañas
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    console.log('Click en pestaña:', this.getAttribute('data-section'));
                    const sectionId = this.getAttribute('data-section');
                    cambiarSeccion(sectionId);
                });
            });
            
            // Botones de navegación del formulario
            document.getElementById('siguiente-irat').addEventListener('click', () => {
                console.log('Click en siguiente IRAT');
                if (validarSeccionIdentificacion()) cambiarSeccion('evaluacion');
            });
            document.getElementById('volver-identificacion').addEventListener('click', () => {
                console.log('Click en volver identificación');
                cambiarSeccion('identificacion');
            });
            document.getElementById('siguiente-tinetti').addEventListener('click', () => {
                console.log('Click en siguiente Tinetti');
                if (validarSeccionIRAT5()) cambiarSeccion('tinetti');
            });
            document.getElementById('volver-irat').addEventListener('click', () => {
                console.log('Click en volver IRAT');
                cambiarSeccion('evaluacion');
            });
            document.getElementById('siguiente-norton').addEventListener('click', () => {
                console.log('Click en siguiente Norton');
                if (validarSeccionTinetti()) cambiarSeccion('norton');
            });
            document.getElementById('volver-tinetti').addEventListener('click', () => {
                console.log('Click en volver Tinetti');
                cambiarSeccion('tinetti');
            });
            document.getElementById('calcular-resultados').addEventListener('click', calcularResultadosCompletos);
            document.getElementById('volver-norton').addEventListener('click', () => {
                console.log('Click en volver Norton');
                cambiarSeccion('norton');
            });
            document.getElementById('nueva-evaluacion').addEventListener('click', iniciarNuevaEvaluacion);
        }

        function cambiarSeccion(sectionId) {
            console.log('Cambiando a sección:', sectionId);
            
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar sección seleccionada
            const seccion = document.getElementById(sectionId);
            if (seccion) {
                seccion.classList.add('active');
                console.log('Sección activada:', sectionId);
            }
            
            // Actualizar pestañas activas
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-section') === sectionId) {
                    tab.classList.add('active');
                }
            });
        }

        // ========== CONFIGURAR EVENTOS ==========
        function configurarEventos() {
            console.log('Configurando eventos...');
            
            // Calcular puntaje IRAT-5 en tiempo real
            ['equilibrio', 'amputacion', 'brazos', 'social', 'cooperacion'].forEach(id => {
                document.getElementById(id).addEventListener('change', calcularPuntajeIRATPreliminar);
            });
            
            // Mostrar/ocultar preguntas Tinetti
            document.getElementById('tinetti-evaluable').addEventListener('change', function() {
                const tinettiPreguntas = document.getElementById('tinetti-preguntas');
                if (this.value === 'evaluable') {
                    tinettiPreguntas.style.display = 'block';
                    tinettiNoEvaluable = false;
                } else if (this.value === 'no-evaluable') {
                    tinettiPreguntas.style.display = 'none';
                    tinettiNoEvaluable = true;
                }
            });
            
            // Evento para Norton
            document.getElementById('puntaje-norton').addEventListener('input', function() {
                puntajeNorton = parseInt(this.value) || 15;
            });
        }

        // ========== VALIDACIONES ==========
        function mostrarErrorCampo(idCampo, mensaje) {
            const errorDiv = document.getElementById(`error-${idCampo}`);
            if (errorDiv) {
                errorDiv.textContent = mensaje;
                errorDiv.style.display = 'block';
            }
        }
        
        function eliminarErrorCampo(idCampo) {
            const errorDiv = document.getElementById(`error-${idCampo}`);
            if (errorDiv) errorDiv.style.display = 'none';
        }
        
        function validarSeccionIdentificacion() {
            let valido = true;
            ['nombre', 'fecha', 'evaluador'].forEach(campo => {
                const elemento = document.getElementById(campo);
                if (!elemento.value.trim()) {
                    elemento.classList.add('error-input');
                    mostrarErrorCampo(campo, 'Este campo es requerido');
                    valido = false;
                } else {
                    elemento.classList.remove('error-input');
                    eliminarErrorCampo(campo);
                }
            });
            if (!valido) alert('Complete todos los campos requeridos');
            return valido;
        }
        
        function validarSeccionIRAT5() {
            let valido = true;
            ['equilibrio', 'amputacion', 'brazos', 'social', 'cooperacion'].forEach(id => {
                const select = document.getElementById(id);
                if (!select.value) {
                    select.classList.add('error-input');
                    mostrarErrorCampo(id, 'Seleccione una opción');
                    valido = false;
                } else {
                    select.classList.remove('error-input');
                    eliminarErrorCampo(id);
                }
            });
            if (!valido) alert('Complete todas las preguntas IRAT-5');
            return valido;
        }
        
        function validarSeccionTinetti() {
            const select = document.getElementById('tinetti-evaluable');
            if (!select.value) {
                select.classList.add('error-input');
                mostrarErrorCampo('tinetti-evaluable', 'Seleccione una opción');
                return false;
            }
            
            select.classList.remove('error-input');
            eliminarErrorCampo('tinetti-evaluable');
            
            if (select.value === 'evaluable') {
                const puntaje = document.getElementById('puntaje-tinetti');
                if (!puntaje.value || puntaje.value < 0 || puntaje.value > 28) {
                    puntaje.classList.add('error-input');
                    mostrarErrorCampo('puntaje-tinetti', 'Ingrese un puntaje válido (0-28)');
                    return false;
                }
                puntaje.classList.remove('error-input');
                eliminarErrorCampo('puntaje-tinetti');
            }
            
            return true;
        }

        // ========== CÁLCULOS ==========
        function calcularPuntajeIRATPreliminar() {
            console.log('Calculando puntaje IRAT-5...');
            let puntaje = 0;
            ['equilibrio', 'amputacion', 'brazos', 'social', 'cooperacion'].forEach(id => {
                const select = document.getElementById(id);
                puntaje += parseInt(select.value) || 0;
            });
            
            const amputacion = document.getElementById('amputacion').value;
            if (amputacion && parseInt(amputacion) >= 3) puntaje += 1;
            
            document.getElementById('puntaje-irat').textContent = puntaje;
            return puntaje;
        }
        
        function calcularResultadosCompletos() {
            try {
                console.log('Calculando resultados completos...');
                
                // Validar última sección
                const puntajeNortonInput = document.getElementById('puntaje-norton');
                if (!puntajeNortonInput.value || puntajeNortonInput.value < 5 || puntajeNortonInput.value > 20) {
                    alert('Ingrese un puntaje Norton válido (5-20)');
                    return;
                }
                
                // Calcular puntajes IRAT-5
                let puntajeIRAT = calcularPuntajeIRATPreliminar();
                
                // Calcular puntos Tinetti para IRAT-5
                let puntosTinettiIRAT = 4;
                if (!tinettiNoEvaluable) {
                    const puntajeTinettiInput = document.getElementById('puntaje-tinetti');
                    puntajeTinetti = parseInt(puntajeTinettiInput.value) || 0;
                    if (puntajeTinetti >= 25) puntosTinettiIRAT = 0;
                    else if (puntajeTinetti >= 19) puntosTinettiIRAT = 2;
                }
                
                puntajeTotalIRAT = puntajeIRAT + puntosTinettiIRAT;
                
                // Niveles de riesgo
                nivelRiesgoIRAT = puntajeTotalIRAT <= 6 ? "BAJO RIESGO" :
                                 puntajeTotalIRAT <= 9 ? "RIESGO MODERADO" :
                                 puntajeTotalIRAT <= 12 ? "ALTO RIESGO" : "MUY ALTO RIESGO";
                
                nivelRiesgoNorton = puntajeNorton >= 16 ? "BAJO RIESGO Úlceras por presión" :
                                   puntajeNorton >= 12 ? "RIESGO MODERADO Úlceras por presión" : 
                                   "ALTO RIESGO Úlceras por presión";
                
                // Recopilar datos completos
                recopilarDatosCompletos();
                
                // Generar recomendaciones
                recomendaciones = generarRecomendaciones();
                
                // Mostrar resultados
                mostrarResultados();
                cambiarSeccion('resultados');
                alert('Resultados calculados exitosamente');
                
            } catch (error) {
                console.error('Error calculando resultados:', error);
                alert('Error: ' + error.message);
            }
        }
        
        function recopilarDatosCompletos() {
            datosCompletos = {
                paciente: {
                    nombre: document.getElementById('nombre').value || 'Sin nombre',
                    fecha: document.getElementById('fecha').value || '',
                    evaluador: document.getElementById('evaluador').value || 'Sin evaluador'
                },
                irat5: {
                    puntaje: puntajeTotalIRAT,
                    riesgo: nivelRiesgoIRAT
                },
                tinetti: {
                    evaluable: !tinettiNoEvaluable,
                    puntaje: tinettiNoEvaluable ? 0 : puntajeTinetti,
                    riesgo: tinettiNoEvaluable ? 'No evaluable' : 
                           puntajeTinetti >= 25 ? 'Bajo riesgo' : 
                           puntajeTinetti >= 19 ? 'Riesgo moderado' : 'Alto riesgo'
                },
                norton: {
                    puntaje: puntajeNorton,
                    riesgo: nivelRiesgoNorton
                },
                resultados: {
                    recomendaciones: recomendaciones
                }
            };
            console.log('Datos completos:', datosCompletos);
        }
        
        function generarRecomendaciones() {
            const recs = [];
            
            if (puntajeTotalIRAT <= 6) {
                recs.push("Bastón simple si es necesario para mayor seguridad");
                recs.push("Ejercicios de equilibrio básicos");
                recs.push("Revisión domiciliaria básica de seguridad");
                recs.push("Seguimiento cada 6 meses");
            } else if (puntajeTotalIRAT <= 9) {
                recs.push("Andador con 2 o 4 ruedas para mayor estabilidad");
                recs.push("Cojín antiescaras para silla o sillón");
                recs.push("Instalación de barras de apoyo en baño");
                recs.push("Programa de ejercicios de fortalecimiento");
            } else if (puntajeTotalIRAT <= 12) {
                recs.push("Andador fijo (sin ruedas) para máxima estabilidad");
                recs.push("Colchón estático de alta densidad");
                recs.push("Supervisión durante la deambulación");
                recs.push("Adaptaciones domiciliarias prioritarias");
            } else {
                recs.push("Silla de ruedas adaptada con cojín antiescaras");
                recs.push("Colchón alternante de aire para prevención UPP");
                recs.push("Plan de movilización cada 2-3 horas");
                recs.push("Valoración por equipo multidisciplinar");
            }
            
            return recs;
        }
        
        function mostrarResultados() {
            try {
                if (!datosCompletos) {
                    throw new Error('No hay datos para mostrar');
                }
                
                const riesgoColorIRAT = nivelRiesgoIRAT.includes("BAJO") ? "#4CAF50" :
                                       nivelRiesgoIRAT.includes("MODERADO") ? "#FF9800" :
                                       nivelRiesgoIRAT.includes("ALTO") ? "#F44336" : "#9C27B0";
                
                const riesgoColorNorton = nivelRiesgoNorton.includes("BAJO") ? "#4CAF50" :
                                         nivelRiesgoNorton.includes("MODERADO") ? "#FF9800" : "#F44336";
                
                const html = `
                    <div style="background: white; padding: 30px; border-radius: 10px; border: 2px solid #e0e0e0;">
                        <div style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid var(--primary-color);">
                            <h2 style="color: var(--primary-color); margin-bottom: 5px;">Informe de Evaluación Clínica</h2>
                            <p style="color: #666;">IRAT-5 Modificado + Test de Tinetti + Escala Norton</p>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h3 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-user"></i> Datos del Paciente
                            </h3>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                                <p><strong>Nombre:</strong> ${datosCompletos.paciente.nombre}</p>
                                <p><strong>Fecha evaluación:</strong> ${datosCompletos.paciente.fecha}</p>
                                <p><strong>Evaluador:</strong> ${datosCompletos.paciente.evaluador}</p>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h3 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-chart-bar"></i> Resultados
                            </h3>
                            
                            <div style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; padding: 25px; border-radius: 10px; text-align: center; margin: 20px 0;">
                                <div>Puntaje Total IRAT-5 Modificado</div>
                                <div style="font-size: 3.5rem; font-weight: bold; margin: 10px 0;">${puntajeTotalIRAT}</div>
                                <div style="background: ${riesgoColorIRAT}; padding: 10px; border-radius: 5px; margin-top: 10px;">
                                    <strong>${nivelRiesgoIRAT}</strong>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                                    <div style="font-weight: 600; color: var(--primary-color); margin-bottom: 10px;">Test de Tinetti</div>
                                    <div style="font-size: 2.5rem; font-weight: bold; margin: 10px 0;">
                                        ${tinettiNoEvaluable ? 'NE' : puntajeTinetti}${tinettiNoEvaluable ? '' : '/28'}
                                    </div>
                                    <div>${datosCompletos.tinetti.riesgo}</div>
                                </div>
                                
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center;">
                                    <div style="font-weight: 600; color: var(--primary-color); margin-bottom: 10px;">Escala Norton</div>
                                    <div style="font-size: 2.5rem; font-weight: bold; margin: 10px 0;">${puntajeNorton}</div>
                                    <div style="background: ${riesgoColorNorton}; color: white; padding: 5px 10px; border-radius: 5px; margin-top: 10px;">
                                        ${nivelRiesgoNorton}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h3 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-prescription-bottle-alt"></i> Recomendaciones
                            </h3>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                                ${recomendaciones.map((rec, index) => `
                                    <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 5px; border-left: 4px solid var(--accent-color);">
                                        <strong>Recomendación ${index + 1}:</strong> ${rec}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0; text-align: right;">
                            <p><strong>Profesional evaluador:</strong> ${datosCompletos.paciente.evaluador}</p>
                            <p style="color: #666; font-size: 0.9rem; margin-top: 10px;">
                                Fecha de emisión: ${new Date().toLocaleDateString('es-ES')}
                            </p>
                        </div>
                    </div>
                `;
                
                document.getElementById('contenido-resultados').innerHTML = html;
                
            } catch (error) {
                console.error('Error mostrando resultados:', error);
                document.getElementById('contenido-resultados').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #F44336;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <h3>Error al cargar resultados</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function iniciarNuevaEvaluacion() {
            if (confirm('¿Está seguro de comenzar una nueva evaluación? Los datos no guardados se perderán.')) {
                location.reload();
            }
        }
    </script>
</body>
</html>
